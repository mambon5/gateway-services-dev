<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>interaction_tunnel &mdash; Gateway communication&#39;s code 01-05-2023 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="local_settings" href="local_settings.html" />
    <link rel="prev" title="global_vars" href="global_vars.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Gateway communication's code
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="backend_script_cloud_comms.html">backend_script_cloud_comms</a></li>
<li class="toctree-l1"><a class="reference internal" href="backend_script_node_comms.html">backend_script_node_comms</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud_settings.html">cloud_settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute_crc.html">compute_crc</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_message_cloud.html">create_message_cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_message_functions.html">create_message_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_message_nodes.html">create_message_nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="create_message_specific_functions.html">create_message_specific_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="database_functions.html">database_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="global_vars.html">global_vars</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">interaction_tunnel</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_settings.html">local_settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_display_functions.html">message_display_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_display_specific_functions.html">message_display_specific_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_received_class.html">message_received_class</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_received_parse_functions.html">message_received_parse_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_specific_parse_functions.html">message_specific_parse_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="mqtt_credentials.html">mqtt_credentials</a></li>
<li class="toctree-l1"><a class="reference internal" href="mqtt_interaction_cloud.html">mqtt_interaction_cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="mqtt_interaction_module.html">mqtt_interaction_module</a></li>
<li class="toctree-l1"><a class="reference internal" href="mqtt_interaction_node_basic.html">mqtt_interaction_node_basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="mqtt_interaction_node_main.html">mqtt_interaction_node_main</a></li>
<li class="toctree-l1"><a class="reference internal" href="mqtt_interaction_node_temporal.html">mqtt_interaction_node_temporal</a></li>
<li class="toctree-l1"><a class="reference internal" href="otap_menu.html">otap_menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="otap_specific_functions.html">otap_specific_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="otap_update_all_nodes.html">otap_update_all_nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="prepare_response.html">prepare_response</a></li>
<li class="toctree-l1"><a class="reference internal" href="read_gw_database.html">read_gw_database</a></li>
<li class="toctree-l1"><a class="reference internal" href="start_gw_comms.html">start_gw_comms</a></li>
<li class="toctree-l1"><a class="reference internal" href="update_gw_database.html">update_gw_database</a></li>
<li class="toctree-l1"><a class="reference internal" href="update_gw_software.html">update_gw_software</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Gateway communication's code</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">interaction_tunnel</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/modules/interaction_tunnel.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-interaction_tunnel">
<span id="interaction-tunnel"></span><h1>interaction_tunnel<a class="headerlink" href="#module-interaction_tunnel" title="Permalink to this headline"></a></h1>
<p>This file passes messages between:</p>
<ol class="arabic simple">
<li><p>cloud –&gt; node</p></li>
<li><p>node –&gt; cloud</p></li>
</ol>
<p>In order to do so, there are two classes. One that creates a tunnel from cloud –&gt; node and another one that creates the
tunnel from node –&gt; cloud, respectively.</p>
<ol class="arabic simple">
<li><p>The <em>cloud –&gt; node</em> tunnel, is created when the cloud sends a message to a specific node. In particular, when the gateway receives
a cloud message targeted at a node “n”, then it will create a <a class="reference internal" href="mqtt_interaction_node_temporal.html#mqtt_interaction_node_temporal.mqtt_interaction_node_temporal" title="mqtt_interaction_node_temporal.mqtt_interaction_node_temporal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mqtt_interaction_node_temporal()</span></code></a> class
with mode set to “request” in order to send messages to the desired node.</p></li>
<li><p>The <em>node –&gt; cloud</em> tunnel is created when the gateway detects a new node in its network. It is created in order to receive messages
from the cloud to this new node. This tunnel basically creates an
<a class="reference internal" href="mqtt_interaction_node_basic.html#mqtt_interaction_node_basic.mqtt_interaction_node_basic" title="mqtt_interaction_node_basic.mqtt_interaction_node_basic"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mqtt_interaction_node_basic()</span></code></a> class that “listens” to new cloud messages for that node.</p></li>
</ol>
<p class="rubric">Functions</p>
<table class="autosummary longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#interaction_tunnel.prepare_cloud_tunnel" title="interaction_tunnel.prepare_cloud_tunnel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">prepare_cloud_tunnel</span></code></a>(msg, node_inter)</p></td>
<td><p>Checks if the node that sent the message is registered or not and acts accordingly.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#interaction_tunnel.tunnel_to_cloud" title="interaction_tunnel.tunnel_to_cloud"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tunnel_to_cloud</span></code></a>(node_id, wni)</p></td>
<td><p>Starts a cloud MQTT subscription for a desired node.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#interaction_tunnel.tunnel_to_node" title="interaction_tunnel.tunnel_to_node"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tunnel_to_node</span></code></a>(cloud_inter, msg[, wni])</p></td>
<td><p>Prepares the message the cloud wants to send to the node.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Classes</p>
<table class="autosummary longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#interaction_tunnel.cloud_to_node_tunnel" title="interaction_tunnel.cloud_to_node_tunnel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cloud_to_node_tunnel</span></code></a>(msg_type, msg_args, ...)</p></td>
<td><p>This class is created when the gateway receives a cloud message that is pointed at a specific node.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#interaction_tunnel.node_to_cloud_tunnel" title="interaction_tunnel.node_to_cloud_tunnel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">node_to_cloud_tunnel</span></code></a>(node_id, wni)</p></td>
<td><p>Class that subscribes the gateway to a global MQTT topic for receiving messages to a specific node.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="interaction_tunnel.cloud_to_node_tunnel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cloud_to_node_tunnel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg_args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cloud_inter</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/interaction_tunnel.html#cloud_to_node_tunnel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#interaction_tunnel.cloud_to_node_tunnel" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class is created when the gateway receives a cloud message that is pointed at a specific node. The gateway will then
create this class in order to transmit the message to the node and make the final step in the transmission.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cloud_inter</strong> (<a class="reference internal" href="mqtt_interaction_cloud.html#mqtt_interaction_cloud.mqtt_interaction_cloud" title="mqtt_interaction_cloud.mqtt_interaction_cloud"><em>mqtt_interaction_cloud</em></a>) – cloud interaction of the gateway. We need to pass the whole interaction in order to allow the tunnel to call it when sending the response to the cloud</p></li>
<li><p><strong>id</strong> (<em>node</em>) – node id to who we wish to communicate</p></li>
<li><p><strong>gw_id</strong> (<em>int</em>) – gateway id that creates the tunneling</p></li>
<li><p><strong>msg_type</strong> (<em>int</em>) – Message type of the message the cloud sent and we want to tunnel to the node</p></li>
<li><p><strong>msg_args</strong> (<em>list</em>) – additional message arguments</p></li>
<li><p><strong>sink_id</strong> (<em>string</em>) – Sink id where nodes connect to the gateway</p></li>
</ul>
</dd>
<dt class="field-even">Does</dt>
<dd class="field-even"><ol class="arabic simple">
<li><p>Receives a series of message parameters from a gateway-cloud interaction</p></li>
<li><p>Creates a temporal gateway-node interaction, and passes on the message</p></li>
</ol>
</dd>
<dt class="field-odd">Structure</dt>
<dd class="field-odd"><ol class="arabic simple">
<li><dl class="simple">
<dt>It has the following methods:</dt><dd><ul class="simple">
<li><p><a class="reference internal" href="#interaction_tunnel.cloud_to_node_tunnel.transmit_message_to_node" title="interaction_tunnel.cloud_to_node_tunnel.transmit_message_to_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transmit_message_to_node()</span></code></a></p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Returns a <a class="reference internal" href="mqtt_interaction_node_temporal.html#mqtt_interaction_node_temporal.mqtt_interaction_node_temporal" title="mqtt_interaction_node_temporal.mqtt_interaction_node_temporal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mqtt_interaction_node_temporal()</span></code></a> class:</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">to_node_inter</dt>
<dd class="field-odd"><p>(mqtt_interaction_node_temporal) – gateway to mesh network interaction of class that the tunnel will create.</p>
</dd>
</dl>
</div></blockquote>
</p>
</dd>
</dl>
<p>Initialize class interaction attributes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="interaction_tunnel.cloud_to_node_tunnel.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg_args</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cloud_inter</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/interaction_tunnel.html#cloud_to_node_tunnel.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#interaction_tunnel.cloud_to_node_tunnel.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Initialize class interaction attributes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="interaction_tunnel.cloud_to_node_tunnel.transmit_message_to_node">
<span class="sig-name descname"><span class="pre">transmit_message_to_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/interaction_tunnel.html#cloud_to_node_tunnel.transmit_message_to_node"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#interaction_tunnel.cloud_to_node_tunnel.transmit_message_to_node" title="Permalink to this definition"></a></dt>
<dd><p>Function responsible for sending the message to the mesh network, the final step in the cloud –&gt; node tunnel.</p>
<dl class="field-list">
<dt class="field-odd">Does</dt>
<dd class="field-odd"><blockquote>
<div><ol class="arabic simple">
<li><p>Sends a node request. Originally, this is determined by the cloud request received by the gateway.</p></li>
<li><p>The <a class="reference internal" href="mqtt_interaction_node_basic.html#mqtt_interaction_node_basic.mqtt_interaction_node_basic.request_to_node" title="mqtt_interaction_node_basic.mqtt_interaction_node_basic.request_to_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request_to_node()</span></code></a> function creates a listening thread, for incoming node messages (possible responses to the previous request)</p></li>
<li><p>We create a <strong>thread.join()</strong> which stops any further tunnel execution, until the right response is received or the max waiting time is achieved.</p></li>
<li><p>If a matching response is received, we return True + the node message response. Otherwise we just output a log message notifying the lack of response.</p></li>
<li><p>In order to respond to the cloud, we will call the <code class="xref py py-meth docutils literal notranslate"><span class="pre">respond_to_cloud()</span></code> using the response message from the node, with a modified topic and id.</p></li>
</ol>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">return</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>result</strong> (<em>list</em>) –</dt><dd><ul class="simple">
<li><p>[0] - <em>bool</em> (True if tunnel to node was successful, False if failed)</p></li>
<li><p>[1] - <em>RxMsg</em> node response message, or <em>None</em> if no message response.</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="interaction_tunnel.node_to_cloud_tunnel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">node_to_cloud_tunnel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wni</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/interaction_tunnel.html#node_to_cloud_tunnel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#interaction_tunnel.node_to_cloud_tunnel" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class that subscribes the gateway to a global MQTT topic for receiving messages to a specific node.
This occurs when an unregistered node sends a message to the gateway.</p>
<dl class="field-list simple">
<dt class="field-odd">Does</dt>
<dd class="field-odd"><ol class="arabic simple">
<li><p>Once it’s invoked, it creates a <a class="reference internal" href="mqtt_interaction_cloud.html#mqtt_interaction_cloud.mqtt_interaction_cloud" title="mqtt_interaction_cloud.mqtt_interaction_cloud"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mqtt_interaction_cloud()</span></code></a> class that will subscribe to the
right MQTT topic in the global broker.</p></li>
<li><p>Every time a cloud message is received in this topic, it will transmit it to the node.</p></li>
</ol>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>cloud_inter</strong> (<a class="reference internal" href="mqtt_interaction_cloud.html#mqtt_interaction_cloud.mqtt_interaction_cloud" title="mqtt_interaction_cloud.mqtt_interaction_cloud"><em>mqtt_interaction_cloud</em></a>) – cloud interaction with the gateway created by node tigger.</p></li>
<li><p><strong>node_id</strong> (<em>int</em>) – node id to who we wish to receive the message from the cloud</p></li>
<li><p><strong>pubtopic</strong> (<em>string</em>) – Publish topic for the cloud interaction. Where should the gateway send its messages to?</p></li>
<li><p><strong>subtopic</strong> (<em>string</em>) – Subscription topic for the cloud interaction. Where should the gateway listen to for cloud messages?</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>Returns a <a class="reference internal" href="#interaction_tunnel.node_to_cloud_tunnel" title="interaction_tunnel.node_to_cloud_tunnel"><code class="xref py py-meth docutils literal notranslate"><span class="pre">node_to_cloud_tunnel()</span></code></a> class with the following attributes:</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">to_node_inter</dt>
<dd class="field-odd"><p>(mqtt_interaction_cloud) – gateway to mesh network interaction of class that the tunnel will create.</p>
</dd>
</dl>
</div></blockquote>
</p>
</dd>
</dl>
<p>Initialize class interaction attributes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="interaction_tunnel.node_to_cloud_tunnel.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wni</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/interaction_tunnel.html#node_to_cloud_tunnel.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#interaction_tunnel.node_to_cloud_tunnel.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Initialize class interaction attributes.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="interaction_tunnel.prepare_cloud_tunnel">
<span class="sig-name descname"><span class="pre">prepare_cloud_tunnel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">node_inter</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/interaction_tunnel.html#prepare_cloud_tunnel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#interaction_tunnel.prepare_cloud_tunnel" title="Permalink to this definition"></a></dt>
<dd><p>Checks if the node that sent the message is registered or not and acts accordingly.</p>
<dl class="field-list simple">
<dt class="field-odd">Does</dt>
<dd class="field-odd"><ol class="arabic simple">
<li><p>Checks if the node that sent the message is registered or not.</p></li>
<li><p>If the message comes from an unregistered node, a MQTT cloud subscription will be created via the</p></li>
</ol>
</dd>
</dl>
<p>function <a class="reference internal" href="#interaction_tunnel.tunnel_to_cloud" title="interaction_tunnel.tunnel_to_cloud"><code class="xref py py-meth docutils literal notranslate"><span class="pre">tunnel_to_cloud()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_inter</strong> (<a class="reference internal" href="mqtt_interaction_node_main.html#mqtt_interaction_node_main.mqtt_interaction_node_main" title="mqtt_interaction_node_main.mqtt_interaction_node_main"><em>mqtt_interaction_node_main</em></a>) – main node interaction of the gateway. We need to pass the whole interaction in order to allow the tunnel use the node id for the subscription</p></li>
<li><p><strong>msg</strong> (<a class="reference internal" href="message_received_class.html#message_received_class.RxMsg" title="message_received_class.RxMsg"><em>RxMsg</em></a>) – message received from the nodes</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt><strong>result</strong> (<em>list</em>)</dt><dd><ul class="simple">
<li><p>[0] - <em>bool</em> – (True if successful, False if failed)</p></li>
<li><p>[1] - <a class="reference internal" href="mqtt_interaction_cloud.html#mqtt_interaction_cloud.mqtt_interaction_cloud" title="mqtt_interaction_cloud.mqtt_interaction_cloud"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mqtt_interaction_cloud()</span></code></a>/<em>None</em> – if a tunneling to the cloud is needed, it passes the whole <a class="reference internal" href="mqtt_interaction_cloud.html#mqtt_interaction_cloud.mqtt_interaction_cloud" title="mqtt_interaction_cloud.mqtt_interaction_cloud"><code class="xref py py-meth docutils literal notranslate"><span class="pre">mqtt_interaction_cloud()</span></code></a> class.
Otherwise, it returns <em>None</em>.</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="interaction_tunnel.tunnel_to_cloud">
<span class="sig-name descname"><span class="pre">tunnel_to_cloud</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wni</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/interaction_tunnel.html#tunnel_to_cloud"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#interaction_tunnel.tunnel_to_cloud" title="Permalink to this definition"></a></dt>
<dd><p>Starts a cloud MQTT subscription for a desired node.
This interaction is triggered when the gateway receives a messages from an unregistered node.</p>
<p>What it does:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Creates a <a class="reference internal" href="#interaction_tunnel.node_to_cloud_tunnel" title="interaction_tunnel.node_to_cloud_tunnel"><code class="xref py py-class docutils literal notranslate"><span class="pre">node_to_cloud_tunnel</span></code></a> class.</p></li>
<li><p>Starts the cloud interaction listening thread to recieved any cloud messages designed to this node</p></li>
</ol>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_id</strong> (<em>int</em>) – id of the node that should receive the cloud messages</p></li>
<li><p><strong>wni</strong> (<em>WirepasNetworkInterface</em>) – wirepas interface, we need it in order to create the otapHelper and requests node information to the sink directly</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt><strong>result</strong> (<em>list</em>)</dt><dd><ul class="simple">
<li><p>[0] - <em>bool</em> – (True if successful, False if failed)</p></li>
<li><p>[1] -  <a class="reference internal" href="mqtt_interaction_cloud.html#mqtt_interaction_cloud.mqtt_interaction_cloud" title="mqtt_interaction_cloud.mqtt_interaction_cloud"><code class="xref py py-class docutils literal notranslate"><span class="pre">mqtt_interaction_cloud</span></code></a> – mqtt interaction class with the cloud, the whole class is passed.</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="interaction_tunnel.tunnel_to_node">
<span class="sig-name descname"><span class="pre">tunnel_to_node</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cloud_inter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wni</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/interaction_tunnel.html#tunnel_to_node"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#interaction_tunnel.tunnel_to_node" title="Permalink to this definition"></a></dt>
<dd><p>Prepares the message the cloud wants to send to the node. It also sends the message and reports the response.</p>
<dl class="field-list simple">
<dt class="field-odd">Note</dt>
<dd class="field-odd"><p>When the gateway receives a cloud request to get the node version, it won’t send a command directly to the node but it will send an</p>
</dd>
</dl>
<p>OTAP command to the sink, asking for the scratchpad of that node, which will contain the node version.</p>
<dl class="field-list">
<dt class="field-odd">Does</dt>
<dd class="field-odd"><ol class="arabic">
<li><p>Checks whether the cloud message is targeted towards a node or the gateway itself.</p></li>
<li><p>If it is aimed at a <strong>node</strong>, then it can be either for</p>
<blockquote>
<div><ul class="simple">
<li><p>getting the node version (in which case a direct otap message to the sink is sent)</p></li>
<li><p>Anything else, for which a <a class="reference internal" href="#interaction_tunnel.cloud_to_node_tunnel" title="interaction_tunnel.cloud_to_node_tunnel"><code class="xref py py-class docutils literal notranslate"><span class="pre">cloud_to_node_tunnel</span></code></a> class is created,
and the message is sent to the node using the <a class="reference internal" href="#interaction_tunnel.cloud_to_node_tunnel.transmit_message_to_node" title="interaction_tunnel.cloud_to_node_tunnel.transmit_message_to_node"><code class="xref py py-meth docutils literal notranslate"><span class="pre">transmit_message_to_node()</span></code></a></p></li>
</ul>
</div></blockquote>
</li>
<li><p>If the message is targeted towards the gateway, then no tunnel to the node is needed, and <em>None</em> is sent back to the cloud</p></li>
<li><p>A few seconds after the message is sent to the node, a response message is received.</p></li>
<li><p>The response from the node is returned together with a boolean (True/False) that determines if the tunnel to the node was
successful or not.</p></li>
</ol>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>cloud_inter</strong> (<a class="reference internal" href="mqtt_interaction_cloud.html#mqtt_interaction_cloud.mqtt_interaction_cloud" title="mqtt_interaction_cloud.mqtt_interaction_cloud"><em>mqtt_interaction_cloud</em></a>) – cloud interaction of the gateway. We need to pass the whole interaction in order to allow the tunnel to call it when the node sends the response back to the cloud</p></li>
<li><p><strong>msg</strong> (<a class="reference internal" href="message_received_class.html#message_received_class.RxMsg" title="message_received_class.RxMsg"><em>RxMsg</em></a>) – the message received</p></li>
<li><p><strong>wni</strong> (<em>WirepasNetworkInterface</em>) – wirepas interface, we need it in order to create the otapHelper and requests node information to the sink directly</p></li>
</ul>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><dl class="simple">
<dt><strong>result</strong> (<em>list</em>)</dt><dd><ul>
<li><p>[0] - <strong>Success</strong> <em>(bool)</em> – (True if successful, False if failed)</p></li>
<li><p>[1] - <strong>Response msg</strong> <em>(RxMsg)</em> – response message from the node. Or error message, or None if no tunnel is needed.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="global_vars.html" class="btn btn-neutral float-left" title="global_vars" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="local_settings.html" class="btn btn-neutral float-right" title="local_settings" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Romà Masana.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>