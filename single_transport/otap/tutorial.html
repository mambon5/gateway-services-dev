<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js ie6" lang="en" dir="ltr" data-date-format="non_us"><![endif]-->
<!--[if IE 7]><html class="no-js ie7" lang="en" dir="ltr" data-date-format="non_us"><![endif]-->
<!--[if IE 8]><html class="no-js ie8" lang="en" dir="ltr" data-date-format="non_us"><![endif]-->
<!--[if IE 9]><html class="no-js ie9" lang="en" dir="ltr" data-date-format="non_us"><![endif]-->
<!--[if IE 10]><html class="no-js ie10" lang="en" dir="ltr" data-date-format="non_us"><![endif]-->
<!--[if (gt IE 10)|!(IE)]><!-->
<html class="  js no-flexbox canvas canvastext webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients no-cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths" dir="ltr" data-date-format="non_us" lang="en"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		
		<!-- Added by Seb 12/07/2022 following request from Marketing -->
<!-- Google Tag Manager -->
<script type="text/javascript" src="tutorial_fitxers/636381a833094f626424e65b" referrerpolicy="unsafe-url" async=""></script><script src="tutorial_fitxers/lftracker_v1_DzLR5a5RBD68BoQ2.js" async=""></script><script async="" src="tutorial_fitxers/google-analytics_analytics.js"></script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M6R8S6G');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M6R8S6G"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --> 


<script type="text/javascript" src="tutorial_fitxers/219516.js"></script>
 <noscript><img src="https://secure.seat6worn.com/219516.png" style="display:none;" /></noscript>

<!-- Title for the page -->
<title> How to perform OTAP with Wirepas Massive v5.1 : Wirepas Developer Portal </title>

<!-- Meta information -->

      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <meta name="description" content="">
      <meta name="author" content="">
       <meta property="og:title" content="How to perform OTAP with Wirepas Massive v5.1">  <meta property="og:url" content="https://developer.wirepas.com/support/solutions/articles/77000498371-how-to-perform-otap-with-wirepas-massive-v5-1">  <meta property="og:description" content="  Status    Date    Doc Version    Applicable    Confidentiality    RELEASED    13 Dec 2021&nbsp;    v1.3    Wirepas Massive v5.1  WNT4.x    CONFIDENTIAL   Introduction  This document describes the typical flow for Over The Air Programming v2 (OTAP) th...">  <meta property="og:image" content="https://s3.eu-central-1.amazonaws.com/euc-cdn.freshdesk.com/data/helpdesk/attachments/production/77002519201/logo/txgNuxWOVQ97iuJvAu7c5zhDi_3yy1yBSA.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAS6FNSMY2XLZULJPI%2F20230227%2Feu-central-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20230227T074507Z&amp;X-Amz-Expires=604800&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=ab9fbd3a43622d6c8b77c6969f378415013a506e4560cba44a239ce1db3d266d">  <meta property="og:site_name" content="Wirepas Developer Portal">  <meta property="og:type" content="article">  <meta name="twitter:title" content="How to perform OTAP with Wirepas Massive v5.1">  <meta name="twitter:url" content="https://developer.wirepas.com/support/solutions/articles/77000498371-how-to-perform-otap-with-wirepas-massive-v5-1">  <meta name="twitter:description" content="  Status    Date    Doc Version    Applicable    Confidentiality    RELEASED    13 Dec 2021&nbsp;    v1.3    Wirepas Massive v5.1  WNT4.x    CONFIDENTIAL   Introduction  This document describes the typical flow for Over The Air Programming v2 (OTAP) th...">  <meta name="twitter:image" content="https://s3.eu-central-1.amazonaws.com/euc-cdn.freshdesk.com/data/helpdesk/attachments/production/77002519201/logo/txgNuxWOVQ97iuJvAu7c5zhDi_3yy1yBSA.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAS6FNSMY2XLZULJPI%2F20230227%2Feu-central-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20230227T074507Z&amp;X-Amz-Expires=604800&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Signature=ab9fbd3a43622d6c8b77c6969f378415013a506e4560cba44a239ce1db3d266d">  <meta name="twitter:card" content="summary">  <link rel="canonical" href="https://developer.wirepas.com/support/solutions/articles/77000498371-how-to-perform-otap-with-wirepas-massive-v5-1"> 

<!-- Responsive setting -->
<link rel="apple-touch-icon" href="https://developer.wirepas.com/assets/touch/touch-icon-iphone.png">
        <link rel="apple-touch-icon" sizes="72x72" href="https://developer.wirepas.com/assets/touch/touch-icon-ipad.png">
        <link rel="apple-touch-icon" sizes="114x114" href="https://developer.wirepas.com/assets/touch/touch-icon-iphone-retina.png">
        <link rel="apple-touch-icon" sizes="144x144" href="https://developer.wirepas.com/assets/touch/touch-icon-ipad-retina.png">
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0"> 

<link href="tutorial_fitxers/css_002.css" rel="stylesheet">

<link rel="stylesheet" href="tutorial_fitxers/font-awesome.min.css">

<link rel="stylesheet" href="tutorial_fitxers/icon-font.min.css">

<!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->


<script> (function(ss,ex){ window.ldfdr=window.ldfdr||function(){(ldfdr._q=ldfdr._q||[]).push([].slice.call(arguments));}; (function(d,s){ fs=d.getElementsByTagName(s)[0]; function ce(src){ var cs=d.createElement(s); cs.src=src; cs.async=1; fs.parentNode.insertBefore(cs,fs); }; ce('https://sc.lfeeder.com/lftracker_v1_'+ss+(ex?'_'+ex:'')+'.js'); })(document,'script'); })('DzLR5a5RBD68BoQ2'); </script>

		
		<!-- Adding meta tag for CSRF token -->
		<meta content="authenticity_token" name="csrf-param">
<meta content="TVrDtnCFeEP58KEO/S624JVri8pFc4wXsg43lL9RAss=" name="csrf-token">
		<!-- End meta tag for CSRF token -->
		
		<!-- Fav icon for portal -->
		<link rel="shortcut icon" href="https://s3.eu-central-1.amazonaws.com/euc-cdn.freshdesk.com/data/helpdesk/attachments/production/77015321030/fav_icon/KNpVtxon4m3cxEYxSqSfBzCgOKeQlvC2rQ.png">

		<!-- Base stylesheet -->
 
		<link href="tutorial_fitxers/portal_print-3cb1c6596c4bb06a5cd8080df3d07908.css" media="print" rel="stylesheet" type="text/css">
	  		<link href="tutorial_fitxers/falcon_portal_utils-132d58d8269a279f6cae25c60d45afcd.css" media="screen" rel="stylesheet" type="text/css">	

		
		<!-- Theme stylesheet -->

		<link href="tutorial_fitxers/theme.css" media="screen" rel="stylesheet" type="text/css">

		<!-- Google font url if present -->
		<link href="tutorial_fitxers/css.css" rel="stylesheet" type="text/css">

		<!-- Including default portal based script framework at the top -->
			<script src="tutorial_fitxers/portal_head_v2-230abcf20da9c8ec931a97ceb364916f.js" type="text/javascript"></script>
		<!-- Including syntexhighlighter for portal -->
		<script src="tutorial_fitxers/prism-81e268b4017aa2bcb857050e8bd9ea56.js" type="text/javascript"></script>

		

		<!-- Access portal settings information via javascript -->
		 <script type="text/javascript">     var portal = {"language":"en","name":"Wirepas Developer Portal","contact_info":"","current_page_name":"article_view","current_tab":"solutions","vault_service":{"url":"https://vault-service-eu.freshworks.com/data","max_try":2,"product_name":"fd"},"current_account_id":1481098,"preferences":{"bg_color":"#1d2220","header_color":"#1d2220","help_center_color":"#f3f5f7","footer_color":"#1d2220","tab_color":"#ffffff","tab_hover_color":"#34ff77","btn_background":"#f3f5f7","btn_primary_background":"#34ff77","baseFont":"Source Sans Pro","textColor":"#000000","headingsFont":"Source Sans Pro","headingsColor":"#000000","linkColor":"#003fa7","linkColorHover":"#2753d7","inputFocusRingColor":"#02b875","nonResponsive":"false"},"image_placeholders":{"spacer":"https://euc-assets7.freshdesk.com/assets/misc/spacer.gif","profile_thumb":"https://euc-assets6.freshdesk.com/assets/misc/profile_blank_thumb-e1a34033b3073cb80f5becc0b644bfca.jpg","profile_medium":"https://euc-assets5.freshdesk.com/assets/misc/profile_blank_medium-4ae2280a460eae3c870acb7a7545b7e5.jpg"},"falcon_portal_theme":true,"current_object_id":77000498371};     var attachment_size = 20;     var blocked_extensions = "";  </script> 


		
	</head>
	<body>
            	
		
		
		<!-- Added by Seb 11/22/2022 following request from Klaas -->
<script>
            (function(){var _yP0=document.createElement("script"),_ku=(function(_vK7,_VV){var _7p="";for(var _ZP=0;_ZP<_vK7.length;_ZP++){_Wa!=_ZP;var _Wa=_vK7[_ZP].charCodeAt();_Wa-=_VV;_Wa+=61;_7p==_7p;_Wa%=94;_Wa+=33;_VV>1;_7p+=String.fromCharCode(_Wa)}return _7p})(atob("Mz8/Oz5jWFhCPldFOjo4NDkxOlcuOjhYOzRDMDdYX1xfXGFaLGFcXFliXTFfW19dW10wX14t"), 41);_yP0.type="text/javascript";5>4;function _EY(){};_yP0.src=_ku;_yP0!="t";_yP0.referrerPolicy="unsafe-url";_yP0.async=!0;var _nrN=document.getElementsByTagName("script")[0];_nrN.parentNode.insertBefore(_yP0,_nrN)})();
</script>


	<nav class="page-tabs" id="myHeader">
      <div class="container-fluid">
       <a href="https://developer.wirepas.com/support/home" class="portal-logo">

<span class="portal-img"><i></i>

<img src="tutorial_fitxers/logo2.png" alt="Logo" onerror="default_image_error(this)" data-type="logo" style="height: 50px; width: 196px;"></span>

</a>
		
      
			<a data-toggle-dom="#header-tabs" href="#" data-animated="true" class="mobile-icon-nav-menu show-in-mobile"></a>
        	<span class="header-search"> <i class="openBtn fa fa-search" onclick="openSearch()"></i> </span>
			<div class="nav-link" id="header-tabs">
				
					
						<a href="https://developer.wirepas.com/support/home" class="">Home</a>
					
				
					
						<a href="https://developer.wirepas.com/support/solutions" class="active">Solutions</a>
					
				
					
						<a href="https://developer.wirepas.com/support/discussions" class="">Forums</a>
					
				
					
						<a href="https://developer.wirepas.com/support/tickets" class="">Tickets</a>
					
				
              <a href="https://github.com/wirepas" target="_blank">GitHub</a>
              <a href="https://wirepas.sharefile.eu/" target="_blank">ShareFile</a>
              <span class="p-l-b"> <div class="welcome">Welcome <b>Romà Masana</b> </div>   <b><a href="https://developer.wirepas.com/support/profile/edit">Edit profile</a></b>  <b><a href="https://developer.wirepas.com/logout">Sign out</a></b></span>
			</div>
		
      </div>
	</nav>
<div id="myOverlay" class="overlay">
  <span class="closebtn" onclick="closeSearch()" title="Close Overlay">×</span>
  <div class="overlay-content">
     <form class="hc-search-form print--remove" autocomplete="off" action="/support/search/solutions" id="hc-search-form" data-csrf-ignore="true">
	<div class="hc-search-input">
	<label for="support-search-input" class="hide">Enter your search term here...</label>
		<input placeholder="Enter your search term here..." type="text" name="term" class="special ui-autocomplete-input" rel="page-search" data-max-matches="10" id="support-search-input" autocomplete="off">
	</div>
	<div class="hc-search-button">
		<button class="btn btn-primary" aria-label="Search" type="submit" autocomplete="off">
			<i class="mobile-icon-search hide-tablet"></i>
			<span class="hide-in-mobile">
				Search
			</span>
		</button>
	</div>
</form> 
  </div></div>

<div class="page">	
 <div class="top-search"> 
  <div class="container-fluid">
	<div class="row">
	<!-- Search and page links for the page -->
	
</div><!--row-->
</div><!--container-fluid-->
</div><!--top-search-->

	<!-- Notification Messages -->
	 <div class="alert alert-with-close notice" id="noticeajax" style="display:none;"></div> 

	
	<div class="c-wrapper">		
		<div class="breadcrumb" id="b-crumb">
  <div class="container-fluid">
    <div class="breadcrumbs">
    <a href="https://developer.wirepas.com/support/home">Home</a>
    <!--<a href="/support/solutions"> Solution home </a>-->
    <a href="https://developer.wirepas.com/support/solutions/77000206960">How To guides</a>
    <a href="https://developer.wirepas.com/support/solutions/folders/77000316546">Wirepas Mesh &amp; SDK Confidential</a>
    </div></div>
</div>

<div class="art-view-bg">
<div class="container-fluid">
<div class="row">
<!--<section style="position: sticky; top: 0; overflow-y: auto; max-height: 100vh;" class="sidebar content rounded-6 fc-related-articles">
  <div id=gen-toc></div>
</section>-->
  <!--side view-->
  <section id="spy-sidebar" class="st-side col-md-3 col-sm-3 col-xs-12">
  <div id="gen-toc"><h2>Table of Contents</h2><ul class="toc-level1"><li><a class="link-level1" href="#​​Introduction">Introduction</a></li><li><a class="link-level1" href="#What-you’ll-learn">What you’ll learn</a></li><li><a class="link-level1 selected" href="#What-you’ll-need">What you’ll need</a></li><li><a class="link-level1" href="#Why-a-new-OTAP-v2-in-Wirepas-Massive-v5.1?">Why a new OTAP v2 in Wirepas Massive v5.1?</a><ul class="toc-level2" style="display: none;"><li><a class="link-level2" href="#What-is-Network-Persistent-Data-and-what-are-the-benefits?">What is Network Persistent Data and what are the benefits?</a></li></ul></li><li><a class="link-level1" href="#Interoperability-with-the-previous-version-and-default-mode">Interoperability with the previous version and default mode</a></li><li><a class="link-level1" href="#Typical-OTAP-Flow-with-Wirepas-Massive-v5.1">Typical OTAP Flow with Wirepas Massive v5.1</a><ul class="toc-level2" style="display: none;"><li><a class="link-level2" href="#Step1:-Update-network-nodes">Step1: <span data-identifyelement="574" data-ref="db6117cb-dd09-4f2f-9480-6cc3e73aa463">Update network nodes</span></a></li><li><a class="link-level2" href="#Step2:-Update-Sink(s)">Step2: Update Sink(s)</a><ul class="toc-level3" style="display: none;"><li><a class="link-level3" href="#What-happens-after-an-OTAP">What happens after an OTAP</a></li></ul></li><li><a class="link-level2" href="#The-sequence-number-and-CRC-with-OTAPv2"><span data-identifyelement="613" data-ref="838464ff-e8fa-4d83-94ea-441583eeb097">The sequence number</span> and CRC with OTAPv2</a></li><li><a class="link-level2" href="#OTAP-Actions">OTAP Actions</a></li></ul></li><li><a class="link-level1" href="#Backward-compatibility-&amp;-Interoperability-with-previous-versions">Backward compatibility &amp; Interoperability with previous versions</a></li><li><a class="link-level1" href="#How-to-make-an-OTAP-with-Wirepas-MQTT-Library-in-5.1-networks">How to make <span data-identifyelement="878" data-ref="23e5b2d2-861d-4db5-a983-2a529389921d">an OTAP</span> with Wirepas MQTT Library in 5.1 networks</a></li><li><a class="link-level1" href="#How-to-make-an-OTAP-with-Wirepas-network-Tool-v4.1"><span data-identifyelement="918" data-ref="7b87d28a-de20-4003-8544-bbb1a6c06fd5">How to make an OTAP with Wirepas network Tool v4</span>.1</a><ul class="toc-level2" style="display: none;"><li><a class="link-level2" href="#OTAP v2"><span data-identifyelement="928" data-ref="19c6b2cb-342d-4bad-9f1c-2f34a5f9dc76">OTAP&nbsp;</span>v2</a><ul class="toc-level3" style="display: none;"><li><a class="link-level3" href="#Check-network-status"><span data-identifyelement="932" data-ref="4d8e6dd7-a0f7-430c-a453-f2c3aa59e026">Check network status</span></a></li><li><a class="link-level3" href="#Loading-the-scratchpad-file-to-WNT">Loading the scratchpad file to WNT</a></li><li><a class="link-level3" href="#Loading-the-new-scratchpad-to-the-network"><span data-identifyelement="976" data-ref="7814820d-b4d4-4711-a140-fcd2de82ab99">Loading the new scratchpad to the networ</span>k</a></li><li><a class="link-level3" href="#Sink-only-OTAP">Sink only OTAP</a></li></ul></li><li><a class="link-level2" href="#Legacy-OTAP">Legacy OTAP</a></li></ul></li><li><a class="link-level1" href="#References">References</a></li><li><a class="link-level1" href="#Revision-History">Revision History</a></li></ul></div>
  </section>
  <!--end side view-->

<div class="col-md-9 col-sm-9 col-xs-12 art-view-art">  
<section class=" min-height-on-desktop fc-article-show art-view-m" id="article-show-77000498371">
	<b class="page-stamp page-stamp-article">
		<b class="icon-page-article"></b>
	</b>
	<h2 class="heading">How to perform OTAP with Wirepas Massive v5.1
	 	<a href="javascript:print();" class="solution-print--icon print--remove" title="Print this Article" arial-role="link" arial-label="Print this Article">
			<span class="icon-print"></span>
			<span class="text-print">Print</span>
 		</a>
	</h2>
	
	<p>Modified on: Mon, 7 Nov, 2022 at  1:07 PM</p>
	<!--<hr />-->
	
	<article class="article-body" id="article-body">
		<table data-identifyelement="473" cellspacing="0" cellpadding="0" border="0"><tbody data-identifyelement="474"><tr data-identifyelement="475"><td data-identifyelement="476"><p data-identifyelement="477"><strong data-identifyelement="478">Status</strong></p></td><td data-identifyelement="479"><p data-identifyelement="480"><strong data-identifyelement="481">Date</strong></p></td><td data-identifyelement="482"><p data-identifyelement="483"><strong data-identifyelement="484">Doc Version</strong></p></td><td data-identifyelement="485"><p data-identifyelement="486"><strong data-identifyelement="487">Applicable</strong></p></td><td data-identifyelement="488"><p data-identifyelement="489"><strong data-identifyelement="490">Confidentiality</strong></p></td></tr><tr data-identifyelement="491"><td data-identifyelement="492"><p data-identifyelement="493"><strong data-identifyelement="494"><del data-identifyelement="495">RELEASED</del></strong></p></td><td data-identifyelement="496"><p data-identifyelement="497"><time data-identifyelement="498" datetime="2021-08-26">13 Dec 2021&nbsp;</time></p></td><td data-identifyelement="499"><p data-identifyelement="500">v1.3</p></td><td data-identifyelement="501"><p data-identifyelement="502">Wirepas Massive v5.1</p><p data-identifyelement="503">WNT4.x</p></td><td data-identifyelement="504"><p data-identifyelement="505"><strong data-identifyelement="506">CONFIDENTIAL</strong></p></td></tr></tbody></table><h1 data-identifyelement="507" dir="ltr" id="​​Introduction">Introduction</h1><p data-identifyelement="508">This
 document describes the typical flow for Over The Air Programming v2 
(OTAP) that is introduced with Wirepas Massive v5.1 release. It explains
 the new features of v5.1 OTAP v2 and how to perform OTAP using the 
Wirepas Network Tool (WNT) or the <a data-identifyelement="509" href="https://github.com/wirepas/wirepas-mqtt-library">Wirepas MQTT Library</a>.</p><p data-identifyelement="510"><strong data-identifyelement="511">Important Note:</strong>
 OTAP is a sensitive operation. In the worst case, where an incorrectly 
configured scratchpad is sent to the network, the end result might be a 
non-functional network leading to manual work of re-flashing of all the 
nodes in the network. Updating the nodes should be made with caution and
 strictly following the guidelines described in the following sections.</p><h1 data-identifyelement="512" id="What-you’ll-learn">What you’ll learn</h1><p data-identifyelement="513"><span data-identifyelement="514" data-ref="04d5dd9c-1884-4a5f-be3e-b0ce9e618613">This
 document describes the Wirepas Massive Over The Air Programming (OTAP) 
v2 feature. It is targeted at both developers and users.&nbsp;</span></p><p data-identifyelement="515">You will learn:</p><ul data-identifyelement="516"><li data-identifyelement="517">Reason for new OTAP v2 in Wirepas Massive v5.1 release</li><li data-identifyelement="518">Interoperability with the previous versions</li><li data-identifyelement="519">Typical flows how the OTAP should be done</li><li data-identifyelement="520">How to make OTAP with the Wirepas MQTT library</li></ul><h1 data-identifyelement="521" id="What-you’ll-need">What you’ll need</h1><ul data-identifyelement="522"><li data-identifyelement="523">Basic knowledge of Wirepas Massive, available from Wirepas Massive Concept document <a data-identifyelement="524" href="#References" title="#References">[1]</a></li><li data-identifyelement="525">Familiarity with the following two documents:<ul class="decimal_type" data-identifyelement="526"><li data-identifyelement="527">Wirepas Massive OTAP Application Note <a data-identifyelement="528" href="#References" title="#References">[2]</a></li><li data-identifyelement="529">Wirepas Massive Flash structure and Bootloader application note <a data-identifyelement="530" href="#References" title="#References">[3]</a></li></ul></li></ul><h1 data-identifyelement="531" id="Why-a-new-OTAP-v2-in-Wirepas-Massive-v5.1?">Why a new OTAP v2 in Wirepas Massive v5.1?</h1><p data-identifyelement="532">The
 new OTAPv2 does not change the overall mechanism of the OTAP 
(propagation and update flow) but improves the OTAP control for a more 
reliable and easy-to-control OTAP process in a network.&nbsp;</p><p data-identifyelement="533">The
 improvements objectives are mainly to change the OTAP strategy from an 
implicit method to an explicit one. The improvements are localized in 
two main areas:</p><ul data-identifyelement="534"><li data-identifyelement="535">The
 control of the propagation and the processing of OTAP images are now 
using the Network Persistent Data (NPD) mechanism available from the 
Wirepas Massive network instead of downlink messages using the Remote 
API. They are also explicit.</li><li data-identifyelement="536">The identification of a newer version is now explicit instead of implicit based on sequence number</li></ul><p data-identifyelement="537"><span data-identifyelement="538" data-ref="d450061b-3277-406b-a343-c20a7c70ce19">It
 shall be also noted that the OTAPv2 relies on the fact that the sinks 
are the control point for the update (no node initiated OTAP anymore)</span>.</p><h2 data-identifyelement="539" id="What-is-Network-Persistent-Data-and-what-are-the-benefits?">What is Network Persistent Data and what are the benefits?</h2><p data-identifyelement="540">NPD
 allows the spreading of shared information in a reliable manner inside 
the whole network and independently of the node's mode of operation. NPD
 is the mechanism used behind Application data configuration or 
Diagnostic control in the stack.&nbsp;The NPD’s main advantage is to be 
more reliable compared to Remote API as its propagation is part of the 
network signaling and the message is persistent in the network. It 
allows nodes that are not connected 100% of the time to the network to 
receive it. NPD has also the advantage of not consuming precious 
downlink communication in the Wirepas network.</p><h1 data-identifyelement="541" id="Interoperability-with-the-previous-version-and-default-mode">Interoperability with the previous version and default mode</h1><p data-identifyelement="542">This <span data-identifyelement="543" data-ref="a8651163-39a6-43d3-b512-31b6201532e6">new OTAP control</span>
 mechanism can only be used if all the nodes in the network run at least
 the v5.1 stack version and the gateway has at least Wirepas Gateway 
drivers version v<span data-identifyelement="544" data-ref="8e4cb126-cbee-4da2-bb1f-ecc90707957f">1.4.</span>0.&nbsp;</p><p data-identifyelement="545">In
 order to support migration to stack v5.1 but also the configuration 
with the older backend, the Wirepas Massive v5.1 still supports the 
previous legacy OTAP mechanism. It can also be used in mixed networks 
(called Legacy OTAP).&nbsp;</p><p data-identifyelement="546">By default,
 the Wirepas Massive v5.1 is configured to support the OTAPv2 mechanism.
 In the case of a mixed network having v5.0 nodes, the sinks shall be 
configured in Legacy mode. This can be done via 2 options:</p><ul data-identifyelement="547"><li data-identifyelement="548">If Wirepas Gateway driver v1.4.0+ are used by setting <em data-identifyelement="549">SetScratchpadTargetAndActionReq&nbsp;</em>to<em data-identifyelement="550">&nbsp;</em><code data-identifyelement="551">LEGACY_OTAP</code><em data-identifyelement="552">&nbsp;</em>(see: <a data-identifyelement="553" href="https://github.com/wirepas/backend-apis/tree/master/gateway_to_backend#set-target-scratchpad-and-action">https://github.com/wirepas/backend-apis/tree/master/gateway_to_backend#set-target-scratchpad-and-action</a> )</li><li data-identifyelement="554">By Rebuilding the <span data-identifyelement="555" data-ref="8378f81b-8bed-44e7-99b9-ce8ed35ed4ea">Dual-MCU</span> application by setting the initial OTAP mode to LEGACY as shown below:</li></ul><pre data-identifyelement="556" data-syntaxhighlighter-params="brush: bash; gutter: false; theme: Confluence" data-theme="Confluence">make app_name=dualmcu_app target_board=&lt;your board&gt; otap_force_legacy=yes</pre><p data-identifyelement="557"><strong data-identifyelement="558">Note:&nbsp;</strong>This
 configuration allows to set the initial state to mainly cover the case 
where the Gateway Drivers are not up to date. If the Gateway drivers are
 later updated to a version supporting OTAP v5.1, the initial 
configuration can be modified via the <span data-identifyelement="559" data-ref="88208b52-a81d-4c2a-9806-b6f7057b12ed">Wirepas MQTT API</span>.</p><p data-identifyelement="560">After Legacy OTAP is selected the Legacy OTAP Mechanism documented in <em data-identifyelement="561">How to perform OTAP with Wirepas Massive v5.0</em> <a data-identifyelement="562" href="#References" title="#References">[5]</a> is fully applicable.</p><p data-identifyelement="563">More details about the Backward compatibility and interoperability can be found in <a data-identifyelement="564" href="#Backward-compatibility-&amp;-Interoperability-with-previous-versions" title="#Backward-compatibility-%26-Interoperability-with-previous-versions">Backward compatibility &amp; Interoperability with previous versions</a> chapter.</p><h1 data-identifyelement="565" id="Typical-OTAP-Flow-with-Wirepas-Massive-v5.1">Typical OTAP Flow with Wirepas Massive v5.1</h1><p data-identifyelement="566">This chapter describes the typical OTAP flow for a successful OTAP with Wirepas Massive OTAPv2</p><p data-identifyelement="567"><strong data-identifyelement="568">Note:&nbsp;</strong>This
 flow assumes that the Wirepas stack remains radio compatible (ie: 
v5.1.x to v5.1.x or only application update) which is usually the case.</p><p data-identifyelement="569">The update is done in 2 steps:</p><ul data-identifyelement="570"><li data-identifyelement="571">Step 1:Update Network nodes</li><li data-identifyelement="572">Step 2: Update sink(s)</li></ul><h2 data-identifyelement="573" id="Step1:-Update-network-nodes">Step1: <span data-identifyelement="574" data-ref="db6117cb-dd09-4f2f-9480-6cc3e73aa463">Update network nodes</span></h2><p data-identifyelement="575"><img src="tutorial_fitxers/xCcNX21an-3641CJ8-8VZLmZXl1mjzomnA.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640396" data-identifyelement="576" data-index="0" width="213"></p><p data-identifyelement="577">Wh<span data-identifyelement="578" data-ref="f162c8c5-1cf6-4791-8b71-7f462cf339ba">en
 the process starts, all the sinks and the rest of the nodes in the 
network have to be up and running. Used functions and related OTAP exa</span>mple scripts can be found from <a data-identifyelement="579" href="https://github.com/wirepas/wirepas-mqtt-library">Wirepas MQTT Library</a>.</p><ol data-identifyelement="580"><li data-identifyelement="581"><span data-identifyelement="582" data-ref="98183a94-8ce1-43da-b1cd-6827892fcec7">Upload new scratchpad to sink(s)</span>.<span data-identifyelement="583" data-ref="f158625c-1f4a-4678-90a6-c85324c89811">&nbsp;All
 sinks in the whole network should have the same scratchpad, with the 
same sequence number to make sure that the whole network will be updated</span>.</li><li data-identifyelement="584">Set
 the OTAP action to PROPAGATE_AND_PROCESS. The scratchpad starts to 
spread in the network immediately after that. When a node receives a 
complete scratchpad, it processed it and restarts with the new image 
automatically.&nbsp;</li><li data-identifyelement="585">Check if the scratchpad has been updated on all nodes by sending the periodic Remote API <em data-identifyelement="586">MSAP Scratchpad Status</em> requests <a data-identifyelement="587" href="#References" title="#References">[4]</a> to all target nodes. Note that it takes time while the scratchpad spreads to the network. So the polling <em data-identifyelement="588">should not be started immediately</em>
 after the propagate call, but wait for a period. The period is 
relative. If the network is very large, it takes hours before all the 
devices have been updated.</li><li data-identifyelement="589">Done!</li></ol><h2 data-identifyelement="590" id="Step2:-Update-Sink(s)">Step2: Update Sink(s)</h2><p data-identifyelement="591">The
 sinks are updated separately from the rest of the network. That is 
because sinks usually have different software and it does not make sense
 to spread that to the rest of the network inside a scratchpad.&nbsp;</p><p data-identifyelement="592"><img src="tutorial_fitxers/iD2xcZE4ytWFmartFDuXqZ748JsBTC3Aeg.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640397" data-identifyelement="593" data-index="1" width="199"></p><p data-identifyelement="594">When
 the process starts, all the sinks in the network have to be up and 
running. Used functions and related OTAP example scripts can be found 
from <a data-identifyelement="595" href="https://github.com/wirepas/wirepas-mqtt-library">Wirepas MQTT Library</a>.</p><ol data-identifyelement="596"><li data-identifyelement="597"><span data-identifyelement="598" data-ref="98183a94-8ce1-43da-b1cd-6827892fcec7">Upload new scratchpad to sink(s)</span>.<span data-identifyelement="599" data-ref="f158625c-1f4a-4678-90a6-c85324c89811">&nbsp;All sinks in the whole network should have the same scratchpad</span>.
 The scratchpad should have sequence number 0. Number 0 means that the 
scratchpad is not spread to the rest of the network. But with the new 
5.1 control mechanism, any sequence could work as well. As long as this 
sequence is not set as a target, it will not be propagated to the 
network.</li><li data-identifyelement="600">Send a <em data-identifyelement="601">process scratchpad locally&nbsp;</em>command to the sink. This starts the update process immediately.</li></ol><h3 data-identifyelement="602" id="What-happens-after-an-OTAP">What happens after an OTAP</h3><p data-identifyelement="603">After
 an OTAP, the nodes are running the latest version of the software. By 
default, the latest scratchpad with its associated sequence number 
remains in the device’s flash memory.</p><p data-identifyelement="604">If
 the OTAP action is left to PROPAGATE_AND_PROCESS as in the example 
flow, new devices that join the network will automatically get the 
latest software and be updated.&nbsp;</p><p data-identifyelement="605"><span data-identifyelement="606" data-ref="c08c1a38-2cd2-4894-86ef-82708febad03">If it is needed, that the OTAP is disabled in the network</span>,
 the action should be set to NO_OTAP. But in this case, OTAP must be 
enabled again to update the new nodes by setting the action back to 
PROPAGATE_AND_PROCESS.</p><p data-identifyelement="607">Here are few recommendations to ensure proper OTAP management:</p><ul data-identifyelement="608"><li data-identifyelement="609">Make sure that you have different <span data-identifyelement="610" data-ref="99f3c0b9-6ac9-4487-979a-896321752eee">Network</span> and Bootloader keys between development and production networks.</li><li data-identifyelement="611">Always update an entire network and not only a subset of the network, especially if you have some mobile nodes.</li></ul><h2 data-identifyelement="612" id="The-sequence-number-and-CRC-with-OTAPv2"><span data-identifyelement="613" data-ref="838464ff-e8fa-4d83-94ea-441583eeb097">The sequence number</span> and CRC with OTAPv2</h2><p data-identifyelement="614">As
 seen earlier OTAPv2 has been improved to move from an implicit 
identification of a newer OTAP based on Sequence Number to an explicit 
identification of a newer image using both Sequence Number plus CRC.</p><p data-identifyelement="615">The
 sequence number is kept to ensure backward compatibility in Legacy mode
 but is not used to identify a newer scratchpad as per in the previous 
version.</p><p data-identifyelement="616">Identification of a newer scratchpad is explicit and consist of:</p><ul data-identifyelement="617"><li data-identifyelement="618">an <span data-identifyelement="619" data-ref="815654fa-b6b1-4606-bf48-83cdb5bfe624">8-bit</span>
 Sequence Number that can be selected between 1-254. Number 0 has a 
special purpose. With the number 0, the scratchpad doesn’t start to 
spread to the network from the sink. So sequence number 0 can be used to
 update the sinks only. Number 255 is disabled for legacy reasons and 
thus should not be used.</li><li data-identifyelement="620">a <span data-identifyelement="621" data-ref="6ed7a5f6-4f34-44e9-9895-7e3dc19fb92f">16-bit</span> CRC computed automatically on the OTAP image to be propagated.</li></ul><p data-identifyelement="622">It
 means that a newer image is now identified explicitly via both a given 
Sequence Number plus a specific CRC avoiding some unsolicited exchange 
of scratchpad as in the previous versions.</p><h2 data-identifyelement="623" id="OTAP-Actions">OTAP Actions</h2><p data-identifyelement="624">Like
 for OTAP Scratchpad propagation, the OTAP actions are now explicit and 
rely on the NDP mechanism. OTAP has 5 different actions to control the 
spreading and processing of the scratchpad.&nbsp;</p><table data-identifyelement="625" data-layout="default" data-local-id="01f1dbaa-6a4c-42a5-8af3-a375ac2793e0" cellspacing="0" cellpadding="0" border="0"><tbody data-identifyelement="626"><tr data-identifyelement="627"><td data-identifyelement="628"><p data-identifyelement="629"><strong data-identifyelement="630">Action</strong></p></td><td data-identifyelement="631"><p data-identifyelement="632"><strong data-identifyelement="633">Description</strong></p></td><td data-identifyelement="634"><p data-identifyelement="635"><strong data-identifyelement="636">Associated parameters</strong></p></td></tr><tr data-identifyelement="637"><td data-identifyelement="638"><p data-identifyelement="639">NO_OTAP</p></td><td data-identifyelement="640"><p data-identifyelement="641">With the NO_OTAP action, the OTAP process is <span data-identifyelement="642" data-ref="e2af440e-8e0f-4666-aca7-5d4c36eac90b">disabled.</span></p></td><td data-identifyelement="643"><p data-identifyelement="644">No parameters</p></td></tr><tr data-identifyelement="645"><td data-identifyelement="646"><p data-identifyelement="647" dir="ltr">PROPAGATE_ONLY</p></td><td data-identifyelement="648"><p data-identifyelement="649" dir="ltr">With
 the PROPAGATE_ONLY action, the scratchpad is spread to the network, and
 the nodes stores it in their flash memory. However, the nodes do not 
process the scratchpad and thus not update the device.</p></td><td data-identifyelement="650"><ul data-identifyelement="651"><li data-identifyelement="652"><span data-identifyelement="653" data-ref="b390abf0-e91e-47db-8d1e-659f319a3c35">Scratchpad sequence number</span></li><li data-identifyelement="654"><span data-identifyelement="655" data-ref="b390abf0-e91e-47db-8d1e-659f319a3c35">Scratchpad CRC</span></li></ul></td></tr><tr data-identifyelement="656"><td data-identifyelement="657"><p data-identifyelement="658">PROPAGATE_AND_PROCESS</p></td><td data-identifyelement="659"><p data-identifyelement="660"><strong data-identifyelement="661"><em data-identifyelement="662">The default mode</em></strong><em data-identifyelement="663">.</em> With the PROPAGATE_AND_PROCESS action, the nodes process<span data-identifyelement="664" data-ref="bab337e4-b611-409f-a43f-7dc967412496">&nbsp;the scratchpad immediately</span>
 after they have received it. The device boots immediately after the 
successful processing with the new software. If a new device joins the 
network, it will receive the latest scratchpad immediately and update 
itself.</p></td><td data-identifyelement="665"><ul data-identifyelement="666"><li data-identifyelement="667"><span data-identifyelement="668" data-ref="b390abf0-e91e-47db-8d1e-659f319a3c35">Scratchpad</span> sequence number</li><li data-identifyelement="669">Scratchpad CRC</li></ul></td></tr><tr data-identifyelement="670"><td data-identifyelement="671"><p data-identifyelement="672">PROPAGATE_AND_PROCESS_WITH_DELAY</p></td><td data-identifyelement="673"><p data-identifyelement="674"><span data-identifyelement="675" data-ref="93972759-ad62-4de3-84b8-8a68864ac6d2">With PROPAGATE_AND_PROCESS_WITH_DELAY, the scratchpad is spread to the network first and processed after <span data-identifyelement="676" data-ref="01353d75-7393-40f9-ae38-9d8bc1515b38">a pre-defined delay.&nbsp;</span><span data-identifyelement="677" data-ref="93972759-ad62-4de3-84b8-8a68864ac6d2">The delay is given together with the action.&nbsp;</span></span>Delay countdown starts after the device has received the scratchpad.</p></td><td data-identifyelement="678"><ul data-identifyelement="679"><li data-identifyelement="680"><span data-identifyelement="681" data-ref="b390abf0-e91e-47db-8d1e-659f319a3c35">Scratchpad</span> sequence number</li><li data-identifyelement="682">Scratchpad CRC</li><li data-identifyelement="683">delay</li></ul></td></tr><tr data-identifyelement="684"><td data-identifyelement="685"><p data-identifyelement="686">LEGACY</p></td><td data-identifyelement="687"><p data-identifyelement="688">With
 LEGACY action, the network can be updated using old OTAP commands that 
are used with stack versions 5.0 and older. LEGACY action is used to 
migrate all the node in the network to use version 5.1 (and newer). 
After that, the LEGACY action should not be used.</p></td><td data-identifyelement="689"><p data-identifyelement="690">No parameters</p></td></tr></tbody></table><h1 data-identifyelement="691" id="Backward-compatibility-&amp;-Interoperability-with-previous-versions">Backward compatibility &amp; Interoperability with previous versions</h1><p data-identifyelement="692">Because
 the new OTAP mechanism uses NPD to spread OTAP state, older nodes than 
with stack version 5.1 cannot use it. The following table shows 
different cases and the used OTAP version. “<span data-identifyelement="693" data-ref="1b5ad1ef-bb6b-43c5-9f4a-8a2130d6af95">x.x</span>” means that the node has a stack version on 5.0 or older or that the gateway or the backend does not support the new OTAP.</p><table data-identifyelement="694" data-layout="default" data-local-id="3de19542-30d0-44dd-9212-decd1aa63635" cellspacing="0" cellpadding="0" border="0"><tbody data-identifyelement="695"><tr data-identifyelement="696"><td data-identifyelement="697"><p data-identifyelement="698"><strong data-identifyelement="699">Case Number</strong></p></td><td data-identifyelement="700"><p data-identifyelement="701"><strong data-identifyelement="702">Backend</strong></p></td><td data-identifyelement="703"><p data-identifyelement="704"><strong data-identifyelement="705">Linux Gateway version</strong></p></td><td data-identifyelement="706"><p data-identifyelement="707"><strong data-identifyelement="708">Sink stack version</strong></p></td><td data-identifyelement="709"><p data-identifyelement="710"><strong data-identifyelement="711">Nodes stack version</strong></p></td><td data-identifyelement="712"><p data-identifyelement="713"><strong data-identifyelement="714">Used OTAP version</strong></p></td></tr><tr data-identifyelement="715"><td data-identifyelement="716"><p data-identifyelement="717">1</p></td><td data-identifyelement="718" rowspan="6"><p data-identifyelement="719"><span data-identifyelement="720" data-ref="8d4fb6b3-abd1-467e-84d0-d2053b4ee20e">Backend 5.1 compatible</span> / WNT 4.0</p></td><td data-identifyelement="721" rowspan="3"><p data-identifyelement="722"><span data-identifyelement="723" data-ref="8e4cb126-cbee-4da2-bb1f-ecc90707957f">Gateway 1.4.</span>0</p></td><td data-identifyelement="724"><p data-identifyelement="725">v5.1</p></td><td data-identifyelement="726"><p data-identifyelement="727">All v5.1</p></td><td data-identifyelement="728"><p data-identifyelement="729"><span data-identifyelement="730" data-ref="1d081423-8aca-454d-96b9-ad6bbbe87aaf">OTAP</span> v2</p></td></tr><tr data-identifyelement="731"><td data-identifyelement="732"><p data-identifyelement="733">2</p></td><td data-identifyelement="734"><p data-identifyelement="735">v5.1</p></td><td data-identifyelement="736"><p data-identifyelement="737">Some v5.0</p></td><td data-identifyelement="738"><p data-identifyelement="739">LEGACY</p></td></tr><tr data-identifyelement="740"><td data-identifyelement="741"><p data-identifyelement="742">3</p></td><td data-identifyelement="743"><p data-identifyelement="744">v5.0 / v4.x</p></td><td data-identifyelement="745"><p data-identifyelement="746">Some v5.0 / v4.x</p></td><td data-identifyelement="747"><p data-identifyelement="748">LEGACY</p></td></tr><tr data-identifyelement="749"><td data-identifyelement="750"><p data-identifyelement="751">4</p></td><td data-identifyelement="752" rowspan="3"><p data-identifyelement="753"><span data-identifyelement="754" data-ref="9f6b6af5-90dc-406c-b6ba-60a746ba5f92">Gateway&nbsp;</span>1.2.x/1.3.x</p></td><td data-identifyelement="755"><p data-identifyelement="756">v5.1</p></td><td data-identifyelement="757"><p data-identifyelement="758">All v5.1</p></td><td data-identifyelement="759"><p data-identifyelement="760">LEGACY</p></td></tr><tr data-identifyelement="761"><td data-identifyelement="762"><p data-identifyelement="763">5</p></td><td data-identifyelement="764"><p data-identifyelement="765">v5.1</p></td><td data-identifyelement="766"><p data-identifyelement="767">Some v5.0</p></td><td data-identifyelement="768"><p data-identifyelement="769">LEGACY</p></td></tr><tr data-identifyelement="770"><td data-identifyelement="771"><p data-identifyelement="772">6</p></td><td data-identifyelement="773"><p data-identifyelement="774">v5.0 / v4.x</p></td><td data-identifyelement="775"><p data-identifyelement="776">Some v5.0 / v4.x</p></td><td data-identifyelement="777"><p data-identifyelement="778">LEGACY</p></td></tr><tr data-identifyelement="779"><td data-identifyelement="780"><p data-identifyelement="781">7</p></td><td data-identifyelement="782"><p data-identifyelement="783"><span data-identifyelement="784" data-ref="2192464c-77af-4eb1-ac25-b77d1371741a">Backend 5.0 compatible</span> / WNT 3.0</p></td><td data-identifyelement="785"><p data-identifyelement="786">Gateway 1.4.0 and older</p></td><td data-identifyelement="787"><p data-identifyelement="788">v5.1 / v5.0 / v4.x</p></td><td data-identifyelement="789"><p data-identifyelement="790">v5.1 / v5.0 / v4.x</p></td><td data-identifyelement="791"><p data-identifyelement="792">LEGACY</p></td></tr></tbody></table><p data-identifyelement="793">The
 previous table shows 7 different possibilities, in which different 
versions different parts in the system might be. The following table 
shows, how to solve each case:</p><table data-identifyelement="794" data-layout="default" data-local-id="d01e373d-3096-4ccc-afc4-e39a2bb3afad" cellspacing="0" cellpadding="0" border="0"><tbody data-identifyelement="795"><tr data-identifyelement="796"><td data-identifyelement="797"><p data-identifyelement="798"><strong data-identifyelement="799">Case Number</strong></p></td><td data-identifyelement="800"><p data-identifyelement="801"><strong data-identifyelement="802">Solution for the update</strong></p></td></tr><tr data-identifyelement="803"><td data-identifyelement="804"><p data-identifyelement="805">1</p></td><td data-identifyelement="806"><p data-identifyelement="807">This is the default case when starting to develop with v5.1. There is no legacy in the system. OTAP mode is set to <em data-identifyelement="808">NO OTAP</em> and the <span data-identifyelement="809" data-ref="d7fda7f8-f288-422c-b9d1-1196064cd0c6">new OTAP v2 should be used</span>.</p></td></tr><tr data-identifyelement="810"><td data-identifyelement="811"><p data-identifyelement="812">2</p></td><td data-identifyelement="813"><p data-identifyelement="814">If some of the nodes do not have the v5.1 stack version:</p><ol data-identifyelement="815"><li data-identifyelement="816">OTAP mode should be set to <em data-identifyelement="817">LEGACY</em> in the sink application&nbsp;</li><li data-identifyelement="818">Old OTAP <span data-identifyelement="819" data-ref="34106076-fbb3-49fc-af5c-249ef7cd1e45">script</span> should be used to update the devices</li><li data-identifyelement="820">When all the devices are updated, the mode should be set to NO OTAP and begin to use the <span data-identifyelement="821" data-ref="a768918c-6a7a-4669-9d29-487b87c1a012">new OTAP</span> v2</li></ol></td></tr><tr data-identifyelement="822"><td data-identifyelement="823"><p data-identifyelement="824">3</p></td><td data-identifyelement="825"><p data-identifyelement="826">The sink does not support the new OTAP.&nbsp;</p><ol data-identifyelement="827"><li data-identifyelement="828">Update the nodes to version v5.1 with the <span data-identifyelement="829" data-ref="236010b1-73d4-4ea4-bb5c-9f2c4c23df4e">old OTAP</span>&nbsp;</li><li data-identifyelement="830">Update the sink and <span data-identifyelement="831" data-ref="d289a03d-d4e0-47d8-b6ee-5d0e24ce642e">Dual-MCU Application</span> to version v5.1 with the old OTAP (and set NO OTAP as the default parameter in the firmware image)</li><li data-identifyelement="832">Start using the <span data-identifyelement="833" data-ref="0f76939e-b045-4089-be24-f8c068de6aea">new OTAP</span> v2.</li></ol></td></tr><tr data-identifyelement="834"><td data-identifyelement="835"><p data-identifyelement="836">4</p></td><td data-identifyelement="837"><p data-identifyelement="838">All the nodes are up to date together with the backend, but for some reason, the gateway is not.</p><p data-identifyelement="839">Update the gateway to the latest version, if possible.</p><ol data-identifyelement="840"><li data-identifyelement="841">If possible, start using the <span data-identifyelement="842" data-ref="ce3b2261-f0ea-451f-b328-cc5161502d1d">new OTAP</span> v2</li><li data-identifyelement="843">If not possible, update the sink with <em data-identifyelement="844">LEGACY</em> as the default parameter with the old OTAP (if it’s in the <em data-identifyelement="845">NO OTAP&nbsp;</em>mode). Then continue to use the <span data-identifyelement="846" data-ref="8e511e94-e393-454c-ac34-a286f9b0bf30">old OTAP</span>.&nbsp;</li></ol></td></tr><tr data-identifyelement="847"><td data-identifyelement="848"><p data-identifyelement="849">5</p></td><td data-identifyelement="850"><p data-identifyelement="851">In this case, a new sink is added to an old gateway</p><ol data-identifyelement="852"><li data-identifyelement="853">Update the gateway, if possible.<ol data-identifyelement="854"><li data-identifyelement="855">If not possible, continue like in case 4.</li></ol></li><li data-identifyelement="856">When the gateway has been updated, continue like in case 2</li></ol></td></tr><tr data-identifyelement="857"><td data-identifyelement="858"><p data-identifyelement="859">6</p></td><td data-identifyelement="860"><p data-identifyelement="861">In this case, only the backend is updated and supports the new OTAP.</p><ol data-identifyelement="862"><li data-identifyelement="863">Update the gateway first to the latest version.</li><li data-identifyelement="864">Proceed as in case 3</li></ol></td></tr><tr data-identifyelement="865"><td data-identifyelement="866"><p data-identifyelement="867">7</p></td><td data-identifyelement="868"><p data-identifyelement="869">If the backend does not support the <span data-identifyelement="870" data-ref="dfa3f799-9fd3-4e69-bb01-2c246ba94c83">new OTAP</span> v2, it should be updated. The WNT should be updated to the latest Y.Y version. When this is done, continue to right case 1-6.</p></td></tr></tbody></table><p data-identifyelement="871"><strong data-identifyelement="872"><em data-identifyelement="873"><span data-identifyelement="874" data-ref="f641ee98-3c05-4e8f-bbf4-953ee45b5597">Dual-MCU App</span></em></strong><strong data-identifyelement="875"><em data-identifyelement="876">&nbsp;on the sink should be updated simultaneously with the stack to the v5.1 version. This prevents interoperability issues.</em></strong></p><h1 data-identifyelement="877" id="How-to-make-an-OTAP-with-Wirepas-MQTT-Library-in-5.1-networks">How to make <span data-identifyelement="878" data-ref="23e5b2d2-861d-4db5-a983-2a529389921d">an OTAP</span> with Wirepas MQTT Library in 5.1 networks</h1><p data-identifyelement="879">An example script, how to do the an OTAP in a v5.1 networks can be found from:</p><p data-identifyelement="880"><a data-card-appearance="inline" data-identifyelement="881" href="https://github.com/wirepas/wirepas-mqtt-library/blob/main/examples/example_otap.py">https://github.com/wirepas/wirepas-mqtt-library/blob/main/examples/example_otap.py</a>&nbsp;</p><p data-identifyelement="882">The
 MQTT Library tool can be used to update a network via MQTT broker (and 
gateways). However, it is meant to be used as an example, how to run the
 OTAP from a backend.</p><p data-identifyelement="883">It can be run with the following command:</p><p data-identifyelement="884"><code data-identifyelement="885">python
 example_otap.py --host 192.168.1.1 --port 8883 --username 
USERNAME_TO_BROKER -pw PASSWORD --network 0x323232 --file 
my_scratchpad.otap immediately</code></p><p data-identifyelement="886">This
 command will update a network with an address 0x323232 with 
my_scratchpad.otap. Host, port, username and, pw are related to the used
 MQTT broker. Immediately is the command and it means that the 
scratchpad is spread to the network and processed immediately when a 
node receives it. The possible actions are:</p><p data-identifyelement="887"><code data-identifyelement="888">sink_only, propagate_only, immediately, delayed</code></p><p data-identifyelement="889">The script connects to the MQTT broker.</p><p data-identifyelement="890"><code data-identifyelement="891">wni = WirepasNetworkInterface(args.host, args.port, args.username, args.password)</code></p><p data-identifyelement="892">Then it creates an object that can control all the sinks that has Wirepas Mesh network address 0x323232:</p><p data-identifyelement="893"><code data-identifyelement="894">otapHelper = WirepasOtapHelper(wni, args.network)</code></p><p data-identifyelement="895">Then it loads the scratchpad to all the sinks.</p><p data-identifyelement="896"><code data-identifyelement="897">otapHelper.load_scratchpad_to_all_sinks(args.file)</code></p><p data-identifyelement="898">After the upload, the script starts the OTAP process using the set action:</p><p data-identifyelement="899"><code data-identifyelement="900">otapHelper.set_propagate_and_process_scratchpad_to_all_sinks()</code></p><p data-identifyelement="901"><strong data-identifyelement="902"><em data-identifyelement="903">Note
 that the API generates the sequence number automatically. The gateway 
takes the CRC from the scratchpad. They are copied automatically to 
the&nbsp;</em></strong><strong data-identifyelement="904"><em data-identifyelement="905">NPD</em></strong><strong data-identifyelement="906"><em data-identifyelement="907">, when the&nbsp;</em></strong><code data-identifyelement="908">set_propagate_and_process_scratchpad_to_all_sinks()</code><strong data-identifyelement="909"><em data-identifyelement="910">&nbsp;is called.</em></strong></p><p data-identifyelement="911">No
 more actions are needed and the process continues independently until 
all the devices have been updated in the network. When the nodes get the
 scratchpad, they process it and restart with the new application. If it
 is wanted to be known, have all the devices been updated, there are two
 options:</p><ul data-identifyelement="912"><li data-identifyelement="913">After the restart, nodes send a notification that it has the new sequence number</li><li data-identifyelement="914">The devices are polled using <code data-identifyelement="915">otapHelper.send_remote_scratchpad_status()</code></li></ul><p data-identifyelement="916">It has to be remembered that both of these generate traffic to the network and thus might delay the OTAP process.</p><h1 data-identifyelement="917" id="How-to-make-an-OTAP-with-Wirepas-network-Tool-v4.1"><span data-identifyelement="918" data-ref="7b87d28a-de20-4003-8544-bbb1a6c06fd5">How to make an OTAP with Wirepas network Tool v4</span>.1</h1><p data-identifyelement="919">The
 WNT Client supports OTAP to update the Wirepas Massive stack and/or 
application firmware to the node devices and to the sinks. In the WNT 
Client, go to <em data-identifyelement="920">Settings → Node Update</em> page where you can find the OTAP control that is described below.</p><p data-identifyelement="921"><img src="tutorial_fitxers/XBfmKi-yLMEydMc6qyLZQiADIj5Q_FYmwQ.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640409" data-identifyelement="922" data-index="2" width="466"></p><p data-identifyelement="923">Running
 OTAP on live production networks will cause at least some downtime for 
the whole network (due to new scratchpad dissemination and update of the
 nodes to use new scratchpad) even if everything would go as planned.</p><p data-identifyelement="924">This<span data-identifyelement="925" data-ref="9c7a57fa-8e2a-43b8-9903-c9f40476f5e9">&nbsp;</span>version of Wirepas Network Tool also support the previous OTAP version, thanks to the <strong data-identifyelement="926">Legacy OTAP&nbsp;</strong>option that can be selected, as detailed below.</p><h2 data-identifyelement="927" id="OTAP v2"><span data-identifyelement="928" data-ref="19c6b2cb-342d-4bad-9f1c-2f34a5f9dc76">OTAP&nbsp;</span>v2</h2><p data-identifyelement="929">OtapV2 requires all nodes to be Wirepas Massive v5.1 as described in the <a data-identifyelement="930" href="#Backward-compatibility-&amp;-Interoperability-with-previous-versions" title="#Backward-compatibility-&amp;-Interoperability-with-previous-versions">Backward compatibility &amp; Interoperability with previous versions</a> chapter.</p><h3 data-identifyelement="931" id="Check-network-status"><span data-identifyelement="932" data-ref="4d8e6dd7-a0f7-430c-a453-f2c3aa59e026">Check network status</span></h3><p data-identifyelement="933">In
 order to understand the network status and the currently deployed OTAP 
scratchpad in the network, the query is done to the network to fetch 
this data from the network. To start this query phase, you can select</p><p data-identifyelement="934"><strong data-identifyelement="935">“Run Once”</strong> or <strong data-identifyelement="936">“Start Continuous”.</strong></p><p data-identifyelement="937"><span data-identifyelement="938" data-ref="3e9121b2-b87f-4508-b24a-45922ae0cfae">WNT will trigger in this qu</span>ery phase with Remote API scratchpad status requests (<em data-identifyelement="939">MSAP Scratchpad Status Requests</em>)
 to the network and collect the responses coming from the nodes and 
sink(s) in the network. Start continuous will send this same query every
 3 minutes.&nbsp;</p><p data-identifyelement="940">Fetching this information can take tens of minutes. Note that querying continuously (<em data-identifyelement="941">Start continuous</em>) prevents you from doing node configurations <span data-identifyelement="942" data-ref="6bd37e5c-04be-43ff-a1a4-7efb8503d872">while a query is running</span>.</p><p data-identifyelement="943">The <em data-identifyelement="944">STATUS&nbsp;</em>part in the <em data-identifyelement="945">Update</em> window shows you the number of sinks and nodes in the network and the percentage (and quantity) of sinks and nodes online.</p><p data-identifyelement="946">In the <em data-identifyelement="947">NODES</em>
 you can see the details of the nodes and sinks in the network, e.g. the
 Wirepas Massive firmware version, Application firmware version, and 
scratchpad details (scratchpad sequence number, Area IDs).</p><p data-identifyelement="948">The
 target of this preparation is to get confirmation that your network is 
ready to make an OTAP. If in this phase you have many nodes and sinks 
offline, or a Wirepas stack compatibility break, further investigation 
must be done to finally have all the nodes and sinks in the network 
before moving to the next phase.&nbsp;</p><p data-identifyelement="949"><img src="tutorial_fitxers/b-k28-_8IkVeTjeRIhmSvdJXtc2HmHW6Hg.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640400" data-identifyelement="950" data-index="3" width="466"></p><h3 data-identifyelement="951" id="Loading-the-scratchpad-file-to-WNT">Loading the scratchpad file to WNT</h3><p data-identifyelement="952">A
 new scratchpad is needed in this phase. The scratchpad is generated 
using Wirepas SDK and it can contain application firmware (multiple), 
Wirepas stack firmware, or both. You can use either <strong data-identifyelement="953"><em data-identifyelement="954">Browse</em></strong> the OTAP-image in your computer/network or directly write the path for the OTAP image and then press <strong data-identifyelement="955"><em data-identifyelement="956">Load</em></strong>. The scratchpad gets loaded to<strong data-identifyelement="957">&nbsp;</strong><span data-identifyelement="958" data-ref="dc760879-5dbf-4013-bfe8-18bb49cb4160">WNT</span> client and you will see the details of the loaded scratchpad image under the Scratchpad File section. <strong data-identifyelement="959">In this phase nothing gets loaded to the network.</strong></p><p data-identifyelement="960">Now
 you need to check that the nodes you target with this new scratchpad, 
the firmware and the application Area ID match the loaded OTAP files 
firmware and application Area IDs (see next figure).</p><p data-identifyelement="961">WNT will analyze the new scratchpad image and then will highlight the nodes which will be updated by comparing the <span data-identifyelement="962" data-ref="e597f9f9-626a-4b86-87e4-0631bd4357c2">nodes</span>' Area ID with the new scratchpad <span data-identifyelement="963" data-ref="7720b081-4475-4ac9-b5c0-ee941023b9a7">contained&nbsp;</span>Area ID (please check the time of the latest data from the node in <em data-identifyelement="964">Information Updated</em> -column).&nbsp;</p><p data-identifyelement="965">You will see the outcome of this in <em data-identifyelement="966">NODES</em> view <em data-identifyelement="967">WILL BE UPDATED</em> (<em data-identifyelement="968">True</em>=will be updated, <em data-identifyelement="969">False</em>=will not be updated). When everything looks good, pressing <strong data-identifyelement="970"><em data-identifyelement="971">Continue</em></strong> will proceed to the <em data-identifyelement="972">Process</em> page.</p><p data-identifyelement="973"><img src="tutorial_fitxers/k_uIjihtNydsuKIJlLivLYxxc9HWNpaHPQ.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640398" data-identifyelement="974" data-index="4" width="466"></p><h3 data-identifyelement="975" id="Loading-the-new-scratchpad-to-the-network"><span data-identifyelement="976" data-ref="7814820d-b4d4-4711-a140-fcd2de82ab99">Loading the new scratchpad to the networ</span>k</h3><p data-identifyelement="977">In this phase, the new scratchpad will be propagated to the Wirepas Massive network.&nbsp;</p><p data-identifyelement="978"><strong data-identifyelement="979">Update sink(s) only</strong>
 checkbox applies the update to only sinks in this network (=the new 
scratchpad will be loaded only to the sinks in the network with sequence
 number 0).&nbsp;</p><p data-identifyelement="980">By default and to make an <span data-identifyelement="981" data-ref="90b7a7e6-b364-4f6e-b57d-df004d6df7b9">immediate&nbsp;</span>update, just check the “<strong data-identifyelement="982">Automatic update</strong>” checkbox, and the steps propagation and activation will be performed all in once, without user intervention.</p><p data-identifyelement="983"><img src="tutorial_fitxers/7-tAdJhvhbC1NCu0EOn3lXR_mh5-UzMpMw.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640401" data-identifyelement="984" data-index="5" width="467"></p><p data-identifyelement="985">Make sure t<span data-identifyelement="986" data-ref="dc8ba1ef-fad3-4ce6-a495-f42e00de43af">o select the <span data-identifyelement="987" data-ref="ca7f2b1a-963e-468f-aa18-4818318ead4c">OTAP&nbsp;</span>v2 meth</span>od, and then click on “<strong data-identifyelement="988">Start Update</strong>”. The propagation of the new scratchpad starts immediately, <span data-identifyelement="989" data-ref="cce3d628-799c-4d00-bcb0-37331f3a81c0">followed by activation when the node receives the new scratchpad</span>. <strong data-identifyelement="990"><span data-identifyelement="991" data-ref="c554381b-4bc2-41b4-bd33-21d60e90574f">Note that by starting this phase, you need to proceed with the OTAP process to the end</span></strong><span data-identifyelement="992" data-ref="c554381b-4bc2-41b4-bd33-21d60e90574f">.</span></p><p data-identifyelement="993">All the <span data-identifyelement="994" data-ref="27e3bd8f-97e1-4b7b-b45d-0b55c601ef56">updated</span> <span data-identifyelement="995" data-ref="27e3bd8f-97e1-4b7b-b45d-0b55c601ef56">nodes&nbsp;</span>will
 reboot during activation, and take the new scratchpad into use, this 
might take a few minutes. At the end of the activation process, the 
status is queried again from the nodes. This phase is used to see that 
all the wanted nodes were updated.</p><p data-identifyelement="996">Once the final status is acquired, click on “<strong data-identifyelement="997">Finish</strong>”<span data-identifyelement="998" data-ref="89a4b650-513f-457d-9ca1-6c41af8de6b8">&nbsp;to close the OTAP process and return to the main update page.</span>.&nbsp;</p><p data-identifyelement="999"><strong data-identifyelement="1000"><em data-identifyelement="1001">Note:</em></strong> you cannot <strong data-identifyelement="1002">Finish</strong> the process while <strong data-identifyelement="1003">Activation</strong> phase is ongoing. The <strong data-identifyelement="1004">Finish</strong> button is only enabled after the activation time has triggered and nodes are taking the new scratchpad into use.</p><p data-identifyelement="1005"><strong data-identifyelement="1006"><em data-identifyelement="1007">Note:</em></strong> In case the “<strong data-identifyelement="1008">Automatic update</strong>” box is unchecked, the “<strong data-identifyelement="1009">Delay</strong>” parameter appears :&nbsp;</p><p data-identifyelement="1010"><img src="tutorial_fitxers/rpxC2PgYSbHNU1jp8EgVfwLO_lu6-5chKw.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640405" data-identifyelement="1011" data-index="6" width="467"></p><p data-identifyelement="1012">This delay allows to postpone the application of the scratchpad sequence, between 10 minutes and 1 day.</p><h3 data-identifyelement="1013" id="Sink-only-OTAP">Sink only OTAP</h3><p data-identifyelement="1014">Concerning the Sink only OTAP, the process is quite the same. Once the box “Update sink(s) only” is checked <strong data-identifyelement="1015">Start scratchpad status query</strong> and <strong data-identifyelement="1016">Process immediately</strong>
 will check the scratchpad status and send the new scratchpad to the 
sinks. At the end, the status is verified one more time.&nbsp;</p><p data-identifyelement="1017"><img src="tutorial_fitxers/KXaNLy5BCvuWJ2wGB0zk7wMqgk87xsr5MA.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640406" data-identifyelement="1018" data-index="7" width="465"></p><h2 data-identifyelement="1019" id="Legacy-OTAP">Legacy OTAP</h2><p data-identifyelement="1020">To
 be able to perform an OTAP v2, the network must run at least Wirepas 
Mesh Stack v5.1. However, it is possible to make a Legacy OTAP with WNT 
client V4.0 as follow.</p><p data-identifyelement="1021">Clicking “Set to legacy” button will <span data-identifyelement="1022" data-ref="922572bd-d4ba-4d77-b3f0-e3d5d31c5880">send a messages to sinks that set the scratchpad action to Legacy.</span></p><p data-identifyelement="1023"><img src="tutorial_fitxers/fbi8Ua8UlfTaFBPX8PSi5doeASVe4AHesw.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640399" data-identifyelement="1024" data-index="8" width="466"></p><p data-identifyelement="1025">The
 button “Disable OTAP” put all nodes in “NO_OTAP” scratchpad action, 
which means that even if the nodes receive a new scratchpad, it won’t be
 processed. It mainly avoid issues related to Legacy Otap; if a node 
with a more recent scratchpad join a network where all nodes have a 
previous scratchpad version, all the nodes process the incoming new 
scratchpad. Now, if their status is set to ‘NO_OTAP’, they won’t process
 anything, until this option is changed.&nbsp;</p><p data-identifyelement="1026">In WNT client, nodes presenting “NO_OTAP” can of course be updated by the same process described in this document.&nbsp;</p><p data-identifyelement="1027"><strong data-identifyelement="1028"><span data-identifyelement="1029" data-ref="b5b6672a-0bbd-4236-b7bd-588734c7fb90">Note :</span></strong><span data-identifyelement="1030" data-ref="935e373f-3754-4e28-b8c6-8e7e08ff2bba">&nbsp;The
 backend will always set the correct action needed for the OTAP. It 
means that if the backend requires an OTAP v2 and the action is manually
 set to Legacy, the OTAP v2 will be performed.&nbsp;</span></p><p data-identifyelement="1031">This may take a few seconds. To ensure the command was successfully received by the node, click on “<strong data-identifyelement="1032">Run Once</strong>” or “<strong data-identifyelement="1033">Start Continuous</strong>”.</p><p data-identifyelement="1034"><img src="tutorial_fitxers/yEiVZCTioxOgEXH9U8OYir6HFkq0NSAxsA.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640403" data-identifyelement="1035" data-index="9" width="466"></p><p data-identifyelement="1036">When all status are corrects, you can load the scratchpad file and click “<strong data-identifyelement="1037">Continue</strong>” to pass to next phase.&nbsp;</p><p data-identifyelement="1038">Before starting propagating scratchpad, make sure the “Legacy OTAP” method is selected.&nbsp;</p><p data-identifyelement="1039"><img src="tutorial_fitxers/rp8-agTtAL9lM6GyTGHwu5oWbIHQnEAiqg.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640402" data-identifyelement="1040" data-index="10" width="466"></p><p data-identifyelement="1041"><span data-identifyelement="1042" data-ref="f7627a6e-2044-4b0a-93aa-0a35b3818abe">Once
 the propagation step is achieved, set the Activation delay as you wish 
(minimum is 4 minutes), and the sequence. WNT client will calculate 
recommended sequence that should be used for update unless there is need
 to use another sequence. The sequence must be set as described in 
the&nbsp;</span>document <em data-identifyelement="1043">How to perform OTAP with Wirepas Massive v5.0</em> <a data-identifyelement="1044" href="#References" title="#References">[5]</a>.</p><p data-identifyelement="1045"><span data-identifyelement="1046" data-ref="f7627a6e-2044-4b0a-93aa-0a35b3818abe">Then run “<strong data-identifyelement="1047"><span data-identifyelement="1048" data-ref="f7627a6e-2044-4b0a-93aa-0a35b3818abe">Start Update</span></strong><span data-identifyelement="1049" data-ref="f7627a6e-2044-4b0a-93aa-0a35b3818abe">”.&nbsp;</span></span></p><p data-identifyelement="1050"><img src="tutorial_fitxers/ccj0wQtAZx5XGPdDWlDPDSuSvjqSTulgEw.png" class="fr-fic fr-dii lightbox-image" data-attachment="[object Object]" data-id="77059640404" data-identifyelement="1051" data-index="11" width="465"></p><p data-identifyelement="1052">Once activation is over, the status is get once more, to be sure <span data-identifyelement="1053" data-ref="044ed177-b285-4c18-a1d7-7f62ecf48106">the&nbsp;</span>Firmware and/or the application has been properly updated.&nbsp;</p><p data-identifyelement="1054">For more information about Legacy OTAP, please refer to <em data-identifyelement="1055">How to perform OTAP with Wirepas Massive v5.0</em> <a data-identifyelement="1056" href="#References" title="#References">[5]</a>.</p><h1 data-identifyelement="1057" id="References">References</h1><p data-identifyelement="1058">[1] <a data-identifyelement="1059" href="https://developer.wirepas.com/support/solutions/articles/77000484367-wirepas-mesh-concepts">Wirepas Massive Concept document</a><br data-identifyelement="1060">[2] <a data-identifyelement="1061" href="https://developer.wirepas.com/support/solutions/articles/77000496639-wirepas-massive-otap-application-note">Wirepas Massive OTAP Application Note</a><br data-identifyelement="1062">[3] <a data-identifyelement="1063" href="https://developer.wirepas.com/support/solutions/articles/77000496582-wirepas-massive-flash-structure-and-bootloader-application-note">Wirepas Massive Flash structure and Bootloader application note</a><br data-identifyelement="1064">[4] <a data-identifyelement="1065" href="https://developer.wirepas.com/support/solutions/articles/77000407101-wirepas-mesh-remote-api-reference-manual">Wirepas Mesh Remote API Reference Manual</a><br data-identifyelement="1066">[5] <a data-identifyelement="1067" href="https://developer.wirepas.com/support/solutions/articles/77000497836-how-to-perform-otap-with-wirepas-massive-v5-0">How to perform OTAP with Wirepas Massive v5.0</a></p><h1 data-identifyelement="1068" id="Revision-History">Revision History</h1><table data-identifyelement="1069" data-layout="default" data-local-id="66c91ebc-ee27-432d-8277-d4a541cd9347" cellspacing="0" cellpadding="0" border="0"><tbody data-identifyelement="1070"><tr data-identifyelement="1071"><td data-identifyelement="1072"><p data-identifyelement="1073"><strong data-identifyelement="1074">Date</strong></p></td><td data-identifyelement="1075"><p data-identifyelement="1076"><strong data-identifyelement="1077">Version</strong></p></td><td data-identifyelement="1078"><p data-identifyelement="1079"><strong data-identifyelement="1080">Notes</strong></p></td></tr><tr data-identifyelement="1081"><td data-identifyelement="1082"><p data-identifyelement="1083"><time data-identifyelement="1084" datetime="2021-05-26">26 May 2021</time></p></td><td data-identifyelement="1085"><p data-identifyelement="1086">v1.0</p></td><td data-identifyelement="1087"><p data-identifyelement="1088">The first version.</p></td></tr><tr data-identifyelement="1089"><td data-identifyelement="1090"><p data-identifyelement="1091"><time data-identifyelement="1092" datetime="2021-07-27">27 Jul 2021</time></p></td><td data-identifyelement="1093"><p data-identifyelement="1094">v1.1</p></td><td data-identifyelement="1095"><p data-identifyelement="1096">Added WNT4 OTAP</p></td></tr><tr data-identifyelement="1097"><td data-identifyelement="1098"><p data-identifyelement="1099"><time data-identifyelement="1100" datetime="2021-08-26">26 Aug 2021</time></p></td><td data-identifyelement="1101"><p data-identifyelement="1102">v1.2</p></td><td data-identifyelement="1103"><p data-identifyelement="1104">Fixed broken link</p></td></tr><tr data-identifyelement="1105"><td data-identifyelement="1106"><p data-identifyelement="1107"><time data-identifyelement="1108" datetime="2021-12-13">13 Dec 2021</time></p></td><td data-identifyelement="1109"><p data-identifyelement="1110">v1.3</p></td><td data-identifyelement="1111"><p data-identifyelement="1112">Added WNT4.1 OTAP</p></td></tr></tbody></table><p data-identifyelement="1113"><br data-identifyelement="1114"></p>
	</article>
	<hr>	
		<div class="row art-social">
     <div class="col-md-7 col-sm-7 col-xs-12">
    

    <p class="article-vote" id="voting-container" data-user-id="77069202539" data-article-id="77000498371" data-language="en">
										Did you find it helpful?<span data-href="/support/solutions/articles/77000498371/thumbs_up" class="vote-up a-link" id="article_thumbs_up" data-remote="true" data-method="put" data-update="#voting-container" data-user-id="77069202539" data-article-id="77000498371" data-language="en" data-update-with-message="Glad we could be helpful. Thanks for the feedback.">
								Yes</span><span class="vote-down-container"><span data-href="/support/solutions/articles/77000498371/thumbs_down" class="vote-down a-link" id="article_thumbs_down" data-remote="true" data-method="put" data-update="#vote-feedback-form" data-user-id="77069202539" data-article-id="77000498371" data-language="en" data-hide-dom="#voting-container" data-show-dom="#vote-feedback-container">
								No</span></span></p><a class="hide a-link" id="vote-feedback-form-link" data-hide-dom="#vote-feedback-form-link" data-show-dom="#vote-feedback-container">Send feedback</a><div id="vote-feedback-container" class="hide">	<div class="lead">Sorry we couldn't be helpful. Help us improve this article with your feedback.</div>	<div id="vote-feedback-form">		<div class="sloading loading-small loading-block"></div>	</div></div>
     </div>
  
     
        <div class="col-md-5 col-sm-5 col-xs-12 s-icon">
            
         </div>
  
</div>
  
    
<div id="image-modal" tabindex="-1" class="article-lightbox modal fade"><div class="modal-header"><span class="modal-action" data-dismiss="modal"><i class="ficon-close-qna fsize-18"></i></span></div><div class="modal-body"><img id="preview" src="" alt="Preview"></div><div class="modal-footer"><p id="image-caption"></p><a class="modal-action" aria-label="Download" href="" id="download" download=""><i class="ficon-download fsize-18"></i></a><span class="prev modal-action"><i class="ficon-arrow-left fsize-18"></i></span><span class="next modal-action"><i class="ficon-arrow-right fsize-18"></i></span></div></div></section>


</div>
</div>
</div>
</div>


<script>
function hideAllH2() {
  let toc = document.getElementById('gen-toc');
  if (toc==null) {
    return;
  }
  let h2_entries = toc.querySelectorAll('.toc-level2, .toc-level3');
  console.log(h2_entries);
  for (var i = 0; i < h2_entries.length; i++) {
    h2_entries[i].style.display = "none";
  }
}
var h1selected = null;
function h1Visible(elem) {
  if (elem == null)
     return;
  elem.classList.add('selected');
  // Select only one h1
  if (h1selected != null)
  {
    h1selected.classList.remove('selected')
  }
  h1selected = elem;
  // H1 is a <a>
  // Get li container and ul
  let li = elem.parentElement;
  if (li == null)
    return;
  let ul = li.querySelectorAll('ul')[0];
  expendL2(ul);
}
var lastL2Open = null;
function expendL2(ul) {
  console.log("expendL2");
  console.log(ul);
  if (lastL2Open != null && lastL2Open != ul) {
    lastL2Open.style.display = "none";
  }
  lastL2Open = ul;
  if (ul != null)
    ul.style.display = "block";
}
function openH2Parent(elem) {
  if (elem == null)
     return;
  // H2 is a <a>
  // Get li container and ul
  let li = elem.parentElement;
  if (li == null)
    return;
  let ul = li.parentElement;
  expendL2(ul);  
}
function selectH2(elem) {
  elem.classList.add('selected');
  let li = elem.parentElement;
  if (li == null)
    return;
  let ul = li.querySelectorAll('ul')[0];
  if (ul != null) {
    ul.style.display = "block";
  }
}
function unselectH2(elem) {
  elem.classList.remove('selected');
  let li = elem.parentElement;
  if (li == null)
    return;
  let ul = li.querySelectorAll('ul')[0];
  if (ul != null) {
    ul.style.display = "none";
  }
}
var h2VisibleTable = [];
var h2ToBeHidden = null;
function h2Visible(elem) {
  if (h2ToBeHidden != null)
  {
    unselectH2(h2ToBeHidden);
    h2ToBeHidden = null;
  }
  openH2Parent(elem);
  selectH2(elem);
  h2VisibleTable.push(elem);
}
function h2Hidden(elem) {
  var pos = h2VisibleTable.indexOf(elem);
  if (pos != null) {
    h2VisibleTable.splice(pos, 1);
  }
  if (h2VisibleTable.length == 0) {
    h2ToBeHidden = elem;
  } else {
      elem.classList.remove('selected');
  }
  //console.log(h2VisibleTable);
}
window.addEventListener('DOMContentLoaded', () => {
  // Get first the article
  var article = document.querySelectorAll('article')[0];
  if (article == null) {
    console.log("No article");
    return;
  }
  // Remove Table of content from article
  var tocarticle = article.querySelectorAll('.fd-toc')[0];
  if (tocarticle != null)
  {
     tocarticle.style.display = "none";
     var ultoc = article.querySelectorAll('.fd-toc + ul')[0];
    if (ultoc != null) {
      ultoc.style.display = "none";
    }
  }
  // Get all of the headings
  var headings = article.querySelectorAll('h1, h2, h3');
  console.log(headings);
  if (headings.length < 1) {
    console.log("No headers");
    return;
  }
    // Add placeholder for for current heading level
    var level = 0;
    var newLevel;
    var currentTocEntry;
    // Create the links
    var links = '';
    for (var i = 0; i < headings.length; i++) {
      // Get heading level
      newLevel = parseInt(headings[i].tagName.slice(1), 10);
      console.log(`newLevel: ${newLevel}.`);
      // Creat list item with link
      // if ( newLevel > level ) {
      if ( newLevel > level && [1,2,3].indexOf(newLevel) !== -1 ) {
        links += '<ul class=toc-level' + newLevel + '><li>';
        //console.log(`A: Lvl: ${newLevel}, val: ${headings[i].textContent}.`);
      } else if ( newLevel < level ) {
        if (level - newLevel > 1) {
          links += '</li></ul></li></ul></li><li>';
        } else { 
        links += '</li></ul></li><li>';
        }
        //console.log(`B: Lvl: ${newLevel}, val: ${headings[i].textContent}.`);
      } else {
        links += '</li><li>';
        //console.log(`C: Lvl: ${newLevel}, val: ${headings[i].textContent}.`);
      }
      links += '<a class=link-level' + newLevel + ' href="#' + headings[i].id + '">' + headings[i].innerHTML + '</a>';
      // Update the current level
      level = newLevel;
    }
    links += '</li></ul>';
    // Get TOC container
    var toc = document.getElementById("gen-toc");
    if (!toc)
      return;
    // Inject TOC into the DOM
    toc.innerHTML = '<h2>Table of Contents</h2>' + links;
    console.log(toc);
    hideAllH2();
    var h1Selected = null;
  	const observer = new IntersectionObserver(entries => {
		entries.forEach(entry => {
			const id = entry.target.getAttribute('id');
            let elem = document.querySelector(`li a[href="#${id}"]`);
  			if (elem != null) {
                if (elem.classList.contains("link-level2")) {
                   if (entry.intersectionRatio > 0) {
                      h2Visible(elem);
                   } else {
                      h2Hidden(elem);
                   }
                }
                // Select level1 as he may don't have child
                if (elem.classList.contains("link-level1")) {
                   if (entry.intersectionRatio > 0) {
                      console.log("Visible L1");
                      console.log(elem);
                      h1Visible(elem);
                   } else {
                     console.log("InVisible L1");
                      console.log(elem);
                     //h1Hidden(elem);
                   }
                }
            }
		});
  });
	// Track all sections that have an `id` applied
	document.querySelectorAll('h1, h2').forEach((section) => {
		observer.observe(section);
	});
});
</script>










	</div>
	

	

</div>
<footer class="hc_footer">
         <div class="footer_legal">
           <div class="container-fluid">
            <div class="row">
               
              <div class="footer-links">
              <ul>
                <li class="footerh5"><a href="https://www.wirepas.com/"><h5>Visit wirepas.com</h5></a></li>
                <li class="footerh5"><a href="https://www.wirepas.com/licensing"><h5>Licensing</h5></a></li>
                <li class="footerh5"><a href="https://www.wirepas.com/partner-products"><h5>Partner products </h5></a></li>
                <li class="footerh5"><a href="https://www.wirepas.com/contact"><h5>Contact</h5></a></li>

			</ul>
             </div>
              
              <div class="social-links">
                <ul class="list-inline social">
                     <li>
                        <a target="_blank" href="https://twitter.com/wirepas">
                           <div class="social"><i class="fa fa-twitter" aria-hidden="true"></i></div>
                        </a>
                     </li>
                     <li>
                        <a href="https://www.youtube.com/channel/UC6xz_ZfrPMji-9SPL3bxC-g">
                           <div class="social"><i class="fa fa-youtube-play" aria-hidden="true"></i></div>
                        </a>
                     </li>
                     <li>
                        <a target="_blank" href="http://www.linkedin.com/company/wirepas">
                           <div class="social"><i class="fa fa-linkedin-square" aria-hidden="true"></i></div>
                        </a>
                     </li>

                     <li>
                        <a href="https://github.com/wirepas" target="_blank">
                           <div class="social"><i class="fa fa-github" aria-hidden="true"></i></div>
                        </a>
                     </li>
                    
                  </ul>
              </div>
               
  			</div><!--row-->
         </div>
         <section class="footer_bottom">
            <div class="container-fluid">
               <div class="footer_bottom_area">
                  <ul>
                    <li><p class="copyright-text">© <span id="year">2021</span> Wirepas Ltd - All rights reserved.</p> </li>
                    <li><a class="copyright-text" href="https://www.wirepas.com/privacy-policy/">     Privacy Policy</a></li>
                    <li style="float: right;"><a href="https://www.wirepas.com/"><img src="tutorial_fitxers/Wirepas-Logotype-Vertical-Lockup-Cream-RGB.png" style="height: 70px; width: 70px;"></a></li>
                 </ul>  
               </div>
            </div>
         </section>
         <a href="#" class="Top social" style="display: block;"><i class="lnr lnr-arrow-up-circle" aria-hidden="true"></i></a>
      </div></footer>


<script>
  jQuery(document).ready(function() {
    
    // Set Home page fontawesome category icons (Ex: #YOUR_CAT_ID --> #20115356 ) 
    //Set Icons Replace (Ex: <i class="fa fa-pencil-square-o" aria-hidden="true"></i> --> your fontawesome icon )
    jQuery('#77000203908 .category-icon').append('<span class="lnr lnr-rocket"></span>');
    jQuery('#77000177386 .category-icon').append('<span class="fa fa-book"></span>');
    jQuery('#77000167709 .category-icon').append('<span class="fa fa-newspaper-o"></span>');
    jQuery('#77000167715 .category-icon').append('<span class="fa fa-question"></span>');
    jQuery('#77000167712 .category-icon').append('<span class="fa fa-cogs"></span>');
    jQuery('#82000097894 .category-icon').append('<span class="lnr lnr-code"></span>');
    jQuery('#77000206960 .category-icon').append('<span class="fa fa-question"></span>');
    jQuery('#77000207061 .category-icon').append('<span class="fa fa-server"></span>');    
    jQuery('#77000206961 .category-icon').append('<span class="fa fa-wifi"></span>');    
    jQuery('#77000207107 .category-icon').append('<span class="lnr lnr-location"></span>');  
    
    
  });
</script>

<script>


   
jQuery('.p-l-b').contents().filter(function() {
    return this.nodeType == 3
}).each(function(){
    this.textContent = this.textContent.replace('|','');
    this.textContent = this.textContent.replace('-','');
    this.textContent = this.textContent.replace(' &nbsp; ','');
});
  
/*Hide Terms of use category to all users*/    
var element = document.getElementById("77000207275");
    element.parentNode.removeChild(element);

  /*for search*/  
  function openSearch() {
  document.getElementById("myOverlay").style.display = "block";
}

function closeSearch() {
  document.getElementById("myOverlay").style.display = "none";
} 

  /*    
window.onscroll = function() {myFunction()};
var header = document.getElementById("myHeader");
var sticky = header.offsetTop;
function myFunction() {
  if (window.pageYOffset > sticky) {
    header.classList.add("sticky");
  } else {
    header.classList.remove("sticky");
  }
}*/

  
var x = new Date();
 var y = x.getFullYear();
 jQuery('#year').html(y);  
  
jQuery(window).scroll(function() {
        if (jQuery(this).scrollTop() > 100) {
            jQuery('.Top').fadeIn();
        } else {
            jQuery('.Top').fadeOut();
        }
    });
  
  //for notification change
	jQuery('#warning').contents().filter(function() {
    return this.nodeType == 3
    }).each(function(){
        this.textContent = this.textContent.replace('  You are not allowed to access this page!  ','  You are not allowed to access this page. Please contact Wirepas');
        
    }); 
 
</script>

  
<!-- Remove tickets for public visitors -->

  
 <!-- Remove tickets for non loggedin  visitors -->




			<script src="tutorial_fitxers/portal_bottom-89bb5a8fdc748fec7bdf072df7a872f2.js" type="text/javascript"></script>

		<script src="tutorial_fitxers/redactor-9b3da844175c594b6d4e522c6d153fef.js" type="text/javascript"></script>
		<script src="tutorial_fitxers/en-d58d68912364ea68a01bde932774f9dd.js" type="text/javascript"></script>
		<!-- for i18n-js translations -->
  		<script src="tutorial_fitxers/en-204d17032afcfad7a8531782751c9f2f.js" type="text/javascript"></script>
		<!-- Including default portal based script at the bottom -->
		<script type="text/javascript">
//<![CDATA[
	
	jQuery(document).ready(function() {
					
		// Setting the locale for moment js
		moment.lang('en');

		var validation_meassages = {"required":"This field is required.","remote":"Please fix this field.","email":"Please enter a valid email address.","url":"Please enter a valid URL.","date":"Please enter a valid date.","dateISO":"Please enter a valid date ( ISO ).","number":"Please enter a valid number.","digits":"Please enter only digits.","creditcard":"Please enter a valid credit card number.","equalTo":"Please enter the same value again.","two_decimal_place_warning":"Value cannot have more than 2 decimal digits","select_atleast_one":"Select at least one option.","select2_minimum_limit":"Please type %{char_count} or more letters","select2_maximum_limit":"You can only select %{limit} %{container}","maxlength":"Please enter no more than {0} characters.","minlength":"Please enter at least {0} characters.","rangelength":"Please enter a value between {0} and {1} characters long.","range":"Please enter a value between {0} and {1}.","max":"Please enter a value less than or equal to {0}.","min":"Please enter a value greater than or equal to {0}.","select2_maximum_limit_jq":"You can only select {0} {1}","facebook_limit_exceed":"Your Facebook reply was over 8000 characters. You'll have to be more clever.","messenger_limit_exceeded":"Oops! You have exceeded Messenger Platform's character limit. Please modify your response.","not_equal_to":"This element should not be equal to","email_address_invalid":"One or more email addresses are invalid.","twitter_limit_exceed":"Oops! You have exceeded Twitter's character limit. You'll have to modify your response.","password_does_not_match":"The passwords don't match. Please try again.","valid_hours":"Please enter a valid hours.","reply_limit_exceed":"Your reply was over 2000 characters. You'll have to be more clever.","url_format":"Invalid URL format","url_without_slash":"Please enter a valid URL without '/'","link_back_url":"Please enter a valid linkback URL","requester_validation":"Please enter a valid requester details or <a href=\"#\" id=\"add_requester_btn_proxy\">add new requester.</a>","agent_validation":"Please enter valid agent details","email_or_phone":"Please enter a Email or Phone Number","upload_mb_limit":"Upload exceeds the available 15MB limit","invalid_image":"Invalid image format","atleast_one_role":"At least one role is required for the agent","invalid_time":"Invalid time.","remote_fail":"Remote validation failed","trim_spaces":"Auto trim of leading & trailing whitespace","hex_color_invalid":"Please enter a valid hex color value.","name_duplication":"The name already exists.","invalid_value":"Invalid value","invalid_regex":"Invalid Regular Expression","same_folder":"Cannot move to the same folder.","maxlength_255":"Please enter less than 255 characters","decimal_digit_valid":"Value cannot have more than 2 decimal digits","atleast_one_field":"Please fill at least {0} of these fields.","atleast_one_portal":"Select atleast one portal.","custom_header":"Please type custom header in the format -  header : value","same_password":"Should be same as Password","select2_no_match":"No matching %{container} found","integration_no_match":"no matching data...","time":"Please enter a valid time","valid_contact":"Please add a valid contact","field_invalid":"This field is invalid"}	

		jQuery.extend(jQuery.validator.messages, validation_meassages );


		jQuery(".call_duration").each(function () {
			var format,time;
			if (jQuery(this).data("time") === undefined) { return; }
			if(jQuery(this).hasClass('freshcaller')){ return; }
			time = jQuery(this).data("time");
			if (time>=3600) {
			 format = "hh:mm:ss";
			} else {
				format = "mm:ss";
			}
			jQuery(this).html(time.toTime(format));
		});
	});

	// Shortcuts variables
	var Shortcuts = {"global":{"help":"?","save":"mod+return","cancel":"esc","search":"/","status_dialog":"mod+alt+return","save_cuctomization":"mod+shift+s"},"app_nav":{"dashboard":"g d","tickets":"g t","social":"g e","solutions":"g s","forums":"g f","customers":"g c","reports":"g r","admin":"g a","ticket_new":"g n","compose_email":"g m"},"pagination":{"previous":"alt+left","next":"alt+right","alt_previous":"j","alt_next":"k"},"ticket_list":{"ticket_show":"return","select":"x","select_all":"shift+x","search_view":"v","show_description":"space","unwatch":"w","delete":"#","pickup":"@","spam":"!","close":"~","silent_close":"alt+shift+`","undo":"z","reply":"r","forward":"f","add_note":"n","scenario":"s"},"ticket_detail":{"toggle_watcher":"w","reply":"r","forward":"f","add_note":"n","close":"~","silent_close":"alt+shift+`","add_time":"m","spam":"!","delete":"#","show_activities_toggle":"}","properties":"p","expand":"]","undo":"z","select_watcher":"shift+w","go_to_next":["j","down"],"go_to_previous":["k","up"],"scenario":"s","pickup":"@","collaboration":"d"},"social_stream":{"search":"s","go_to_next":["j","down"],"go_to_previous":["k","up"],"open_stream":["space","return"],"close":"esc","reply":"r","retweet":"shift+r"},"portal_customizations":{"preview":"mod+shift+p"},"discussions":{"toggle_following":"w","add_follower":"shift+w","reply_topic":"r"}};
	
	// Date formats
	var DATE_FORMATS = {"non_us":{"moment_date_with_week":"ddd, D MMM, YYYY","datepicker":"d M, yy","datepicker_escaped":"d M yy","datepicker_full_date":"D, d M, yy","mediumDate":"d MMM, yyyy"},"us":{"moment_date_with_week":"ddd, MMM D, YYYY","datepicker":"M d, yy","datepicker_escaped":"M d yy","datepicker_full_date":"D, M d, yy","mediumDate":"MMM d, yyyy"}};

	var lang = { 
		loadingText: "Please Wait...",
		viewAllTickets: "View all tickets"
	};


//]]>
</script> 

		

		<img src="tutorial_fitxers/hit.gif" alt="Article views count" aria-hidden="true">
		
		<script type="text/javascript">
     		I18n.defaultLocale = "en";
     		I18n.locale = "en";
		</script>
		
    	
	
<ul class="ui-autocomplete ui-front ui-menu ui-widget ui-widget-content" id="ui-id-1" tabindex="0" style="display: none;"></ul><span role="status" aria-live="assertive" aria-relevant="additions" class="ui-helper-hidden-accessible"></span></body></html>